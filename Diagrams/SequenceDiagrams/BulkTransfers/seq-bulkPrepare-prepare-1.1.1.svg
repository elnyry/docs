<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="5133px" preserveAspectRatio="none" style="width:2186px;height:5133px;" version="1.1" viewBox="0 0 2186 5133" width="2186px" zoomAndPan="magnify"><defs><filter height="300%" id="fpsko8sxd90ku" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="265" x="961.5" y="23.5352">1.1.1. Bulk Prepare Handler Consume</text><rect fill="#FFFFE0" height="5087.8535" style="stroke: #A80036; stroke-width: 1.0;" width="2049" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="993" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="96" y="171.9082"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="4920.5664" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="337" y="126.2871"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1064" y="4414.9609"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1367.5" y="4994.8535"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="726.1875"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="1154.5352"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="182.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="1384.3301"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="91.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="2628.0254"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="3394.4102"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="183.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="3668.4707"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1629" y="2787.5781"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1629" y="3042.373"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="755.498"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="1183.8457"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="108.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="1413.6406"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="2816.8887"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="3071.6836"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="3423.7207"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="3697.7813"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="4906.5664" style="stroke: #000000; stroke-width: 2.0;" width="2162" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="607" x="247" y="216.9082"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="587" x="257" y="241.2188"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="1027" x="257" y="337.1504"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="3364.9414" style="stroke: #000000; stroke-width: 2.0;" width="1958" x="207" y="508.7031"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="2047.3906" style="stroke: #000000; stroke-width: 2.0;" width="1938" x="217" y="687.5664"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="1865.5273" style="stroke: #000000; stroke-width: 2.0;" width="1918" x="227" y="862.4297"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="1027" x="257" y="886.7402"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="1468.8457" style="stroke: #000000; stroke-width: 2.0;" width="1898" x="237" y="1100.6035"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="1150.1641" style="stroke: #000000; stroke-width: 2.0;" width="1878" x="247" y="1306.0879"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="1118.8535" style="stroke: #000000; stroke-width: 2.0;" width="1858" x="257" y="1330.3984"/><rect fill="#FFFFFF" height="57.2656" style="stroke: none; stroke-width: 1.0;" width="1858" x="257" y="2317.0996"/><rect fill="#FFFFFF" height="74.8867" style="stroke: none; stroke-width: 1.0;" width="1858" x="257" y="2374.3652"/><rect fill="#FFFFFF" height="106.1973" style="stroke: none; stroke-width: 1.0;" width="1898" x="237" y="2463.252"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="77.2422" style="stroke: #000000; stroke-width: 2.0;" width="1214" x="257" y="2485.207"/><rect fill="#FFFFFF" height="151.5078" style="stroke: none; stroke-width: 1.0;" width="1918" x="227" y="2576.4492"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1843" x="257" y="2748.957"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1843" x="257" y="3003.752"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="550.4766" style="stroke: #000000; stroke-width: 2.0;" width="1880" x="247" y="3316.168"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="229.7949" style="stroke: #000000; stroke-width: 2.0;" width="1860" x="257" y="3340.4785"/><rect fill="#FFFFFF" height="289.3711" style="stroke: none; stroke-width: 1.0;" width="1880" x="247" y="3577.2734"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="260.416" style="stroke: #000000; stroke-width: 2.0;" width="1860" x="257" y="3599.2285"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="1145.209" style="stroke: #000000; stroke-width: 2.0;" width="1224" x="247" y="3887.6445"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="483.3848" style="stroke: #000000; stroke-width: 2.0;" width="912" x="257" y="3969.5762"/><rect fill="#FFFFFF" height="572.8926" style="stroke: none; stroke-width: 1.0;" width="1224" x="247" y="4459.9609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="101" x2="101" y1="116.2871" y2="5056.8535"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="342" x2="342" y1="116.2871" y2="5056.8535"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1069" x2="1069" y1="116.2871" y2="5056.8535"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1221" x2="1221" y1="116.2871" y2="5056.8535"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1372" x2="1372" y1="116.2871" y2="5056.8535"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1519" x2="1519" y1="116.2871" y2="5056.8535"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1634" x2="1634" y1="116.2871" y2="5056.8535"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2016" x2="2016" y1="116.2871" y2="5056.8535"/><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="27" y="76.7988"/><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="23" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="30" y="101.334">topic-bulk-prepare</text><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="27" y="5055.8535"/><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="23" y="5059.8535"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="30" y="5080.3887">topic-bulk-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="267" y="113.334">Bulk Prepare Handler</text><ellipse cx="342" cy="83.7988" fill="#FEFECE" filter="url(#fpsko8sxd90ku)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="338,71.7988,344,66.7988,342,71.7988,344,76.7988,338,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="267" y="5069.3887">Bulk Prepare Handler</text><ellipse cx="342" cy="5088.3418" fill="#FEFECE" filter="url(#fpsko8sxd90ku)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="338,5076.3418,344,5071.3418,342,5076.3418,344,5081.3418,338,5076.3418" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="983" y="76.7988"/><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="979" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="986" y="101.334">topic-transfer-prepare</text><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="983" y="5055.8535"/><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="979" y="5059.8535"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="986" y="5080.3887">topic-transfer-prepare</text><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1173" y="76.7988"/><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1169" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1176" y="101.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1173" y="5055.8535"/><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1169" y="5059.8535"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1176" y="5080.3887">Event-Topic</text><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="1288" y="76.7988"/><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="1284" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1291" y="101.334">topic-bulk-processing</text><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="1288" y="5055.8535"/><rect fill="#FEFECE" filter="url(#fpsko8sxd90ku)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="1284" y="5059.8535"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1291" y="5080.3887">topic-bulk-processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1471" y="113.334">Position DAO</text><ellipse cx="1519" cy="83.7988" fill="#FEFECE" filter="url(#fpsko8sxd90ku)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1507" x2="1531" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1471" y="5069.3887">Position DAO</text><ellipse cx="1519" cy="5088.3418" fill="#FEFECE" filter="url(#fpsko8sxd90ku)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1507" x2="1531" y1="5102.3418" y2="5102.3418"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1577" y="113.334">Participant DAO</text><ellipse cx="1634" cy="83.7988" fill="#FEFECE" filter="url(#fpsko8sxd90ku)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1622" x2="1646" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1577" y="5069.3887">Participant DAO</text><ellipse cx="1634" cy="5088.3418" fill="#FEFECE" filter="url(#fpsko8sxd90ku)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1622" x2="1646" y1="5102.3418" y2="5102.3418"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1968" y="113.334">Central Store</text><path d="M1998,63.7988 C1998,53.7988 2016,53.7988 2016,53.7988 C2016,53.7988 2034,53.7988 2034,63.7988 L2034,89.7988 C2034,99.7988 2016,99.7988 2016,99.7988 C2016,99.7988 1998,99.7988 1998,89.7988 L1998,63.7988 " fill="#FEFECE" filter="url(#fpsko8sxd90ku)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1998,63.7988 C1998,73.7988 2016,73.7988 2016,73.7988 C2016,73.7988 2034,73.7988 2034,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1968" y="5069.3887">Central Store</text><path d="M1998,5082.3418 C1998,5072.3418 2016,5072.3418 2016,5072.3418 C2016,5072.3418 2034,5072.3418 2034,5082.3418 L2034,5108.3418 C2034,5118.3418 2016,5118.3418 2016,5118.3418 C2016,5118.3418 1998,5118.3418 1998,5108.3418 L1998,5082.3418 " fill="#FEFECE" filter="url(#fpsko8sxd90ku)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1998,5082.3418 C1998,5092.3418 2016,5092.3418 2016,5092.3418 C2016,5092.3418 2034,5092.3418 2034,5082.3418 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="96" y="171.9082"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="4920.5664" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="337" y="126.2871"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1064" y="4414.9609"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1367.5" y="4994.8535"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="726.1875"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="1154.5352"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="182.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="1384.3301"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="91.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="2628.0254"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="3394.4102"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="183.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="3668.4707"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1629" y="2787.5781"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1629" y="3042.373"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="755.498"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="1183.8457"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="108.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="1413.6406"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="2816.8887"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="3071.6836"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="3423.7207"/><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2011" y="3697.7813"/><path d="M13,133.2871 L269,133.2871 L269,140.2871 L259,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="4906.5664" style="stroke: #000000; stroke-width: 2.0;" width="2162" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="211" x="28" y="146.8555">Bulk Prepare Handler Consume</text><polygon fill="#A80036" points="117,167.9082,107,171.9082,117,175.9082,113,171.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111" x2="336" y1="171.9082" y2="171.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="123" y="167.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="136" y="167.166">Consume Bulk Prepare message</text><path d="M247,216.9082 L331,216.9082 L331,223.9082 L321,233.9082 L247,233.9082 L247,216.9082 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="607" x="247" y="216.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="262" y="230.4766">break</text><path d="M257,241.2188 L399,241.2188 L399,248.2188 L389,258.2188 L257,258.2188 L257,241.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="587" x="257" y="241.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="272" y="254.7871">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="295.1504" y2="295.1504"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="295.1504" y2="308.1504"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="308.1504" y2="308.1504"/><polygon fill="#A80036" points="358,304.1504,348,308.1504,358,312.1504,354,308.1504" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="354" y="282.7529">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="465" x="367" y="275.0977">Validate event - Rule: type == 'bulk-prepare' &amp;&amp; action == 'bulk-prepare'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="367" y="290.4082">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="451" y="290.4082">2001</text><path d="M257,337.1504 L472,337.1504 L472,344.1504 L462,354.1504 L257,354.1504 L257,337.1504 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="1027" x="257" y="337.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="272" y="350.7188">Persist Event Information</text><polygon fill="#A80036" points="1209.5,396.7715,1219.5,400.7715,1209.5,404.7715,1213.5,400.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1215.5" y1="400.7715" y2="400.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="354" y="396.0293">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="367" y="396.0293">Publish event information</text><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="1009" x="264" y="408.7715"/><polygon fill="#EEEEEE" points="264,408.7715,328,408.7715,328,415.7715,318,425.7715,264,425.7715,264,408.7715" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="277" y="423.3398">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="671.5" y="442.3398">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="32" x="829.5" y="442.3398">9.1.0</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="829.5" x2="861.5" y1="444.3398" y2="444.3398"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="861.5" y="442.3398">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="675.5" y="457.6504"/><path d="M207,508.7031 L459,508.7031 L459,515.7031 L449,525.7031 L207,525.7031 L207,508.7031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3364.9414" style="stroke: #000000; stroke-width: 2.0;" width="1958" x="207" y="508.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="222" y="522.2715">Validate Bulk Prepare Transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="547.3242" y2="547.3242"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="547.3242" y2="560.3242"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="560.3242" y2="560.3242"/><polygon fill="#A80036" points="358,556.3242,348,560.3242,358,564.3242,354,560.3242" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="354" y="542.582">4</text><text fill="#AAAAAA" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="367" y="542.582">Schema validation of the incoming message</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="589.6348" y2="589.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="589.6348" y2="602.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="602.6348" y2="602.6348"/><polygon fill="#A80036" points="358,598.6348,348,602.6348,358,606.6348,354,602.6348" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="354" y="584.8926">5</text><text fill="#AAAAAA" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="442" x="367" y="584.8926">Verify the message's signature (to be confirmed in future requirement)</text><path d="M352,615.6348 L352,670.6348 L717,670.6348 L717,625.6348 L707,615.6348 L352,615.6348 " fill="#D3D3D3" filter="url(#fpsko8sxd90ku)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M707,615.6348 L707,625.6348 L717,625.6348 L707,615.6348 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="358" y="633.2031">The above validation steps are already handled by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="358" y="648.5137">the ML-Adapter for the open source implementation.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="358" y="663.8242">It may need to be added in future for custom adapters.</text><path d="M217,687.5664 L428,687.5664 L428,694.5664 L418,704.5664 L217,704.5664 L217,687.5664 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2047.3906" style="stroke: #000000; stroke-width: 2.0;" width="1938" x="217" y="687.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="166" x="232" y="701.1348">Validate Duplicate check</text><polygon fill="#A80036" points="1502,722.1875,1512,726.1875,1502,730.1875,1506,726.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="726.1875" y2="726.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="354" y="721.4453">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="367" y="721.4453">Request to retrieve Hash for a bulkTransferId</text><polygon fill="#A80036" points="1999,751.498,2009,755.498,1999,759.498,2003,755.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2005" y1="755.498" y2="755.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1531" y="750.7559">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="271" x="1544" y="750.7559">Request Transfer Hash for a bulkTransferId</text><polygon fill="#FFFFE0" filter="url(#fpsko8sxd90ku)" points="1924,768.498,2107,768.498,2117,779.498,2107,791.498,1924,791.498,1914,779.498,1924,768.498" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1926" y="785.0664">bulkTransferDuplicateCheck</text><polygon fill="#A80036" points="1535,814.1191,1525,818.1191,1535,822.1191,1531,818.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1529" x2="2015" y1="818.1191" y2="818.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1541" y="813.377">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="1554" y="813.377">Return hash if it exists</text><polygon fill="#A80036" points="358,843.4297,348,847.4297,358,851.4297,354,847.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="847.4297" y2="847.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="364" y="842.6875">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="377" y="842.6875">Return hash if it exists</text><path d="M227,862.4297 L289,862.4297 L289,869.4297 L279,879.4297 L227,879.4297 L227,862.4297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1865.5273" style="stroke: #000000; stroke-width: 2.0;" width="1918" x="227" y="862.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="242" y="875.998">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141" x="304" y="875.0645">[If bulkTransferId exists]</text><path d="M257,886.7402 L472,886.7402 L472,893.7402 L462,903.7402 L257,903.7402 L257,886.7402 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="1027" x="257" y="886.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="272" y="900.3086">Persist Event Information</text><polygon fill="#A80036" points="1209.5,946.3613,1219.5,950.3613,1209.5,954.3613,1213.5,950.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1215.5" y1="950.3613" y2="950.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="945.6191">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="376" y="945.6191">Publish event information</text><rect fill="#FFFFFF" filter="url(#fpsko8sxd90ku)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="1009" x="264" y="958.3613"/><polygon fill="#EEEEEE" points="264,958.3613,328,958.3613,328,965.3613,318,975.3613,264,975.3613,264,958.3613" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="277" y="972.9297">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="671.5" y="991.9297">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="32" x="829.5" y="991.9297">9.1.0</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="829.5" x2="861.5" y1="993.9297" y2="993.9297"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="861.5" y="991.9297">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="675.5" y="1007.2402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="1072.6035" y2="1072.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="1072.6035" y2="1085.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="1085.6035" y2="1085.6035"/><polygon fill="#A80036" points="358,1081.6035,348,1085.6035,358,1089.6035,354,1085.6035" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="1067.8613">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="376" y="1067.8613">Generate Hash for the incoming message and compare hashes</text><path d="M237,1100.6035 L299,1100.6035 L299,1107.6035 L289,1117.6035 L237,1117.6035 L237,1100.6035 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1468.8457" style="stroke: #000000; stroke-width: 2.0;" width="1898" x="237" y="1100.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="252" y="1114.1719">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="200" x="314" y="1113.2383">[BulkTransfer exists, hash matches]</text><polygon fill="#A80036" points="1502,1150.5352,1512,1154.5352,1502,1158.5352,1506,1154.5352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="1154.5352" y2="1154.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="1142.1377">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="376" y="1134.4824">Request to retrieve Bulk Transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="376" y="1149.793">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="453" y="1149.793">2003</text><polygon fill="#A80036" points="1999,1179.8457,2009,1183.8457,1999,1187.8457,2003,1183.8457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2005" y1="1183.8457" y2="1183.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1531" y="1179.1035">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="1553" y="1179.1035">Request BulkTransfer state</text><polygon fill="#FFFFE0" filter="url(#fpsko8sxd90ku)" points="1935,1196.8457,2097,1196.8457,2107,1215.8457,2097,1234.8457,1935,1234.8457,1925,1215.8457,1935,1196.8457" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="1937" y="1213.4141">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1937" y="1228.7246">bulkTransferStateChange</text><polygon fill="#A80036" points="1535,1257.7773,1525,1261.7773,1535,1265.7773,1531,1261.7773" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1529" x2="2015" y1="1261.7773" y2="1261.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1541" y="1257.0352">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="1563" y="1257.0352">Return Transfer state</text><polygon fill="#A80036" points="358,1287.0879,348,1291.0879,358,1295.0879,354,1291.0879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="1291.0879" y2="1291.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="1286.3457">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="386" y="1286.3457">Return Transfer state</text><path d="M247,1306.0879 L331,1306.0879 L331,1313.0879 L321,1323.0879 L247,1323.0879 L247,1306.0879 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1150.1641" style="stroke: #000000; stroke-width: 2.0;" width="1878" x="247" y="1306.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="262" y="1319.6563">break</text><path d="M257,1330.3984 L319,1330.3984 L319,1337.3984 L309,1347.3984 L257,1347.3984 L257,1330.3984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1118.8535" style="stroke: #000000; stroke-width: 2.0;" width="1858" x="257" y="1330.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="272" y="1343.9668">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="268" x="334" y="1343.0332">[If transferState IN ['COMPLETED', 'REJECTED']]</text><polygon fill="#A80036" points="1502,1380.3301,1512,1384.3301,1502,1388.3301,1506,1384.3301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="1384.3301" y2="1384.3301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="1371.9326">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="477" x="376" y="1364.2773">Request to retrieve bulkTransferState, completedTimestamp of the bulk and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="376" y="1379.5879">fulfilment, completedTimestamp for each individual transferId</text><polygon fill="#A80036" points="1999,1409.6406,2009,1413.6406,1999,1417.6406,2003,1413.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2005" y1="1413.6406" y2="1413.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1531" y="1408.8984">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="1553" y="1408.8984">Request fulfilment, completedTimestamp for the transferId</text><polygon fill="#FFFFE0" filter="url(#fpsko8sxd90ku)" points="1937,1426.6406,2095,1426.6406,2105,1452.6406,2095,1479.6406,1937,1479.6406,1927,1452.6406,1937,1426.6406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="1939" y="1443.209">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1939" y="1458.5195">bulkTransferAssociation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1939" y="1473.8301">transferFulfilment</text><polygon fill="#A80036" points="1535,1518.1934,1525,1522.1934,1535,1526.1934,1531,1522.1934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1529" x2="2015" y1="1522.1934" y2="1522.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1541" y="1509.7959">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="1563" y="1502.1406">Return completedTimestamp for bulk and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="441" x="1563" y="1517.4512">fulfilment, completedTimestamp (if they exist) for individual transfers</text><polygon fill="#A80036" points="358,1562.8145,348,1566.8145,358,1570.8145,354,1566.8145" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="1566.8145" y2="1566.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="1554.417">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="386" y="1546.7617">Return completedTimestamp for bulk and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="441" x="386" y="1562.0723">fulfilment, completedTimestamp (if they exist) for individual transfers</text><path d="M352,1579.8145 L352,2262.8145 L870,2262.8145 L870,1589.8145 L860,1579.8145 L352,1579.8145 " fill="#FFFF00" filter="url(#fpsko8sxd90ku)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M860,1579.8145 L860,1589.8145 L870,1589.8145 L860,1579.8145 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="358" y="1597.3828">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="1612.6934">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="374" y="1628.0039">id: &lt;bulkTransferMessage.bulkTransferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="374" y="1643.3145">from: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="374" y="1658.625">to: &lt;bulkTransferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="374" y="1673.9355">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="374" y="1689.2461">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="390" y="1704.5566">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="390" y="1719.8672">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="406" y="1735.1777">bulkTransferState: "COMPLETED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="406" y="1750.4883">individualTransferResults:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="1765.7988">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="1781.1094">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="438" y="1796.4199">transferId: “b51ec534-ee48-4575-b6a9-ead2955b8069”,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="417" x="438" y="1811.7305">fulfilment: “WLctttbu2HvTsa1XWvUoGRcQozHsqeu9Ahl2JW9Bsu8”,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="438" y="1827.041">extensionList:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="438" y="1842.3516">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="454" y="1857.6621">extension:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="454" y="1872.9727">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="470" y="1888.2832">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="486" y="1903.5938">key: "key",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="486" y="1918.9043">“value”: value</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="470" y="1934.2148">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="454" y="1949.5254">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="438" y="1964.8359">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="1980.1465">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="406" y="1995.457">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="406" y="2010.7676">completedTimestamp: "2019-10-24T08:38:08.699-04:00"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="2026.0781">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="374" y="2041.3887">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="374" y="2056.6992">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="390" y="2072.0098">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="406" y="2087.3203">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="406" y="2102.6309">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="406" y="2117.9414">type: bulk-notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="406" y="2133.252">action: bulk-prepare-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="406" y="2148.5625">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="406" y="2163.873">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="422" y="2179.1836">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="422" y="2194.4941">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="2209.8047">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="2225.1152">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="2240.4258">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="2255.7363">}</text><polygon fill="#A80036" points="1360.5,2305.0996,1370.5,2309.0996,1360.5,2313.0996,1364.5,2309.0996" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1366.5" y1="2309.0996" y2="2309.0996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2296.7021">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="432" x="376" y="2289.0469">Publish Notification event for Payer with the completed bulk transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="921" x="376" y="2304.3574">For the Data Model, refer to the Swagger (bulkTransferState - mandatory, individualTransferResults, completedTimestamp - sample values above).</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="257" x2="2115" y1="2318.0996" y2="2318.0996"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="406" x="262" y="2328.7344">[If transferState IN ['RECEIVED', 'PENDING', 'ACCEPTED', 'PROCESSING']]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="2353.3652" y2="2353.3652"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="2353.3652" y2="2366.3652"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="2366.3652" y2="2366.3652"/><polygon fill="#A80036" points="358,2362.3652,348,2366.3652,358,2370.3652,354,2366.3652" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2348.623">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="681" x="376" y="2348.623">This request can be ignored, because a callback will be sent to the client once the bulk transfer is complete.</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="257" x2="2115" y1="2375.3652" y2="2375.3652"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="262" y="2386">[If transferState does not exist]</text><polygon fill="#A80036" points="1360.5,2437.252,1370.5,2441.252,1360.5,2445.252,1364.5,2441.252" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1366.5" y1="2441.252" y2="2441.252"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2421.1992">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="376" y="2405.8887">Send /error callback with appropriate error message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="376" y="2421.1992">(Invalid duplicate request)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="376" y="2436.5098">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="453" y="2436.5098">3100</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="237" x2="2135" y1="2464.252" y2="2464.252"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="242" y="2474.8867">[BulkTransfer exists, hash does not match]</text><path d="M257,2485.207 L341,2485.207 L341,2492.207 L331,2502.207 L257,2502.207 L257,2485.207 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="77.2422" style="stroke: #000000; stroke-width: 2.0;" width="1214" x="257" y="2485.207"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="272" y="2498.7754">break</text><polygon fill="#A80036" points="1360.5,2550.4492,1370.5,2554.4492,1360.5,2558.4492,1364.5,2554.4492" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1366.5" y1="2554.4492" y2="2554.4492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2534.3965">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="376" y="2519.0859">Publish Notification (failure) event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="2534.3965">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="2534.3965">3106</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="496" y="2534.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="487" x="376" y="2549.707">For the Data Model, refer to the final step in this diagram (has the same text).</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="227" x2="2145" y1="2577.4492" y2="2577.4492"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="194" x="232" y="2588.084">[If bulkTransferId does NOT exist]</text><polygon fill="#A80036" points="1502,2624.0254,1512,2628.0254,1502,2632.0254,1506,2628.0254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="2628.0254" y2="2628.0254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2615.6279">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="376" y="2607.9727">Request to persist Transfer Hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="376" y="2623.2832">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="453" y="2623.2832">2003</text><polygon fill="#A80036" points="2004,2653.3359,2014,2657.3359,2004,2661.3359,2008,2657.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2010" y1="2657.3359" y2="2657.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1531" y="2652.5938">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="1553" y="2652.5938">Persist Bulk Transfer message hash</text><polygon fill="#FFFFE0" filter="url(#fpsko8sxd90ku)" points="1924,2670.3359,2107,2670.3359,2117,2681.3359,2107,2693.3359,1924,2693.3359,1914,2681.3359,1924,2670.3359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1926" y="2686.9043">bulkTransferDuplicateCheck</text><polygon fill="#A80036" points="358,2715.957,348,2719.957,358,2723.957,354,2719.957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="2719.957" y2="2719.957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="2715.2148">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="386" y="2715.2148">Return success</text><path d="M257,2748.957 L399,2748.957 L399,2755.957 L389,2765.957 L257,2765.957 L257,2748.957 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1843" x="257" y="2748.957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="272" y="2762.5254">Validate Payer</text><polygon fill="#A80036" points="1617,2783.5781,1627,2787.5781,1617,2791.5781,1621,2787.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1623" y1="2787.5781" y2="2787.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2782.8359">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="376" y="2782.8359">Request to retrieve Payer Participant details (if it exists)</text><polygon fill="#A80036" points="1999,2812.8887,2009,2816.8887,1999,2820.8887,2003,2816.8887" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1639" x2="2005" y1="2816.8887" y2="2816.8887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1646" y="2812.1465">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1668" y="2812.1465">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#fpsko8sxd90ku)" points="1952,2829.8887,2080,2829.8887,2090,2848.8887,2080,2867.8887,1952,2867.8887,1942,2848.8887,1952,2829.8887" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1954" y="2846.457">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1954" y="2861.7676">participantCurrency</text><polygon fill="#A80036" points="1650,2890.8203,1640,2894.8203,1650,2898.8203,1646,2894.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1644" x2="2015" y1="2894.8203" y2="2894.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1656" y="2890.0781">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1678" y="2890.0781">Return Participant details if it exists</text><polygon fill="#A80036" points="358,2920.1309,348,2924.1309,358,2928.1309,354,2924.1309" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1633" y1="2924.1309" y2="2924.1309"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="2919.3887">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="386" y="2919.3887">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="2968.752" y2="2968.752"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="2968.752" y2="2981.752"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="2981.752" y2="2981.752"/><polygon fill="#A80036" points="358,2977.752,348,2981.752,358,2985.752,354,2981.752" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2956.3545">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="376" y="2948.6992">Validate Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="2964.0098">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="2964.0098">3202</text><path d="M257,3003.752 L401,3003.752 L401,3010.752 L391,3020.752 L257,3020.752 L257,3003.752 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1843" x="257" y="3003.752"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="272" y="3017.3203">Validate Payee</text><polygon fill="#A80036" points="1617,3038.373,1627,3042.373,1617,3046.373,1621,3042.373" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1623" y1="3042.373" y2="3042.373"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3037.6309">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="376" y="3037.6309">Request to retrieve Payee Participant details (if it exists)</text><polygon fill="#A80036" points="1999,3067.6836,2009,3071.6836,1999,3075.6836,2003,3071.6836" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1639" x2="2005" y1="3071.6836" y2="3071.6836"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1646" y="3066.9414">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1668" y="3066.9414">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#fpsko8sxd90ku)" points="1952,3084.6836,2080,3084.6836,2090,3103.6836,2080,3122.6836,1952,3122.6836,1942,3103.6836,1952,3084.6836" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1954" y="3101.252">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1954" y="3116.5625">participantCurrency</text><polygon fill="#A80036" points="1650,3145.6152,1640,3149.6152,1650,3153.6152,1646,3149.6152" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1644" x2="2015" y1="3149.6152" y2="3149.6152"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1656" y="3144.873">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1678" y="3144.873">Return Participant details if it exists</text><polygon fill="#A80036" points="358,3174.9258,348,3178.9258,358,3182.9258,354,3178.9258" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1633" y1="3178.9258" y2="3178.9258"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="3174.1836">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="386" y="3174.1836">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="3223.5469" y2="3223.5469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="3223.5469" y2="3236.5469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="3236.5469" y2="3236.5469"/><polygon fill="#A80036" points="358,3232.5469,348,3236.5469,358,3240.5469,354,3236.5469" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3211.1494">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="376" y="3203.4941">Validate Payee</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="3218.8047">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="3218.8047">3203</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="3288.168" y2="3288.168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="3288.168" y2="3301.168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="3301.168" y2="3301.168"/><polygon fill="#A80036" points="358,3297.168,348,3301.168,358,3305.168,354,3301.168" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3275.7705">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="376" y="3268.1152">Validate crypto-condition</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="3283.4258">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="3283.4258">3100</text><path d="M247,3316.168 L309,3316.168 L309,3323.168 L299,3333.168 L247,3333.168 L247,3316.168 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="550.4766" style="stroke: #000000; stroke-width: 2.0;" width="1880" x="247" y="3316.168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="262" y="3329.7363">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="324" y="3328.8027">[Validate Bulk Prepare Transfer (success)]</text><path d="M257,3340.4785 L724,3340.4785 L724,3347.4785 L714,3357.4785 L257,3357.4785 L257,3340.4785 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="229.7949" style="stroke: #000000; stroke-width: 2.0;" width="1860" x="257" y="3340.4785"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="422" x="272" y="3354.0469">Persist Bulk Transfer State (with bulktransferState='RECEIVED')</text><polygon fill="#A80036" points="1502,3390.4102,1512,3394.4102,1502,3398.4102,1506,3394.4102" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="3394.4102" y2="3394.4102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3382.0127">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="376" y="3374.3574">Request to persist bulk transfer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="3389.668">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="3389.668">2003</text><polygon fill="#A80036" points="1999,3419.7207,2009,3423.7207,1999,3427.7207,2003,3423.7207" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2005" y1="3423.7207" y2="3423.7207"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1531" y="3418.9785">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="1553" y="3418.9785">Persist bulkTransfer</text><polygon fill="#FFFFE0" filter="url(#fpsko8sxd90ku)" points="1935,3466.7207,2097,3466.7207,2107,3500.7207,2097,3535.7207,1935,3535.7207,1925,3500.7207,1935,3466.7207" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="1937" y="3483.2891">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="1937" y="3498.5996">bulkTransferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1937" y="3513.9102">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1937" y="3529.2207">bulkTransferExtension</text><polygon fill="#A80036" points="358,3558.2734,348,3562.2734,358,3566.2734,354,3562.2734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="3562.2734" y2="3562.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="3557.5313">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="386" y="3557.5313">Return success</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="247" x2="2127" y1="3578.2734" y2="3578.2734"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="229" x="252" y="3588.9082">[Validate Bulk Prepare Transfer (failure)]</text><path d="M257,3599.2285 L1107,3599.2285 L1107,3606.2285 L1097,3616.2285 L257,3616.2285 L257,3599.2285 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="260.416" style="stroke: #000000; stroke-width: 2.0;" width="1860" x="257" y="3599.2285"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="805" x="272" y="3612.7969">Persist Bulk Transfer State (with bulkTransferState='INVALID') (Introducing a new status INVALID to mark these entries)</text><polygon fill="#A80036" points="1502,3664.4707,1512,3668.4707,1502,3672.4707,1506,3668.4707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="3668.4707" y2="3668.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3648.418">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="376" y="3633.1074">Request to persist bulk transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="376" y="3648.418">(when Payee/Payer/crypto-condition validation fails)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="3663.7285">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="3663.7285">2003</text><polygon fill="#A80036" points="1999,3693.7813,2009,3697.7813,1999,3701.7813,2003,3697.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2005" y1="3697.7813" y2="3697.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1531" y="3693.0391">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1553" y="3693.0391">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#fpsko8sxd90ku)" points="1935,3740.7813,2097,3740.7813,2107,3782.7813,2097,3824.7813,1935,3824.7813,1925,3782.7813,1935,3740.7813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="1937" y="3757.3496">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="1937" y="3772.6602">bulkTransferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1937" y="3787.9707">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1937" y="3803.2813">bulkTransferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1937" y="3818.5918">bulkTransferError</text><polygon fill="#A80036" points="358,3847.6445,348,3851.6445,358,3855.6445,354,3851.6445" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="3851.6445" y2="3851.6445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="3846.9023">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="386" y="3846.9023">Return success</text><path d="M247,3887.6445 L309,3887.6445 L309,3894.6445 L299,3904.6445 L247,3904.6445 L247,3887.6445 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1145.209" style="stroke: #000000; stroke-width: 2.0;" width="1224" x="247" y="3887.6445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="262" y="3901.2129">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="324" y="3900.2793">[Validate Bulk Prepare Transfer (success)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="3941.5762" y2="3941.5762"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="3941.5762" y2="3954.5762"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="3954.5762" y2="3954.5762"/><polygon fill="#A80036" points="358,3950.5762,348,3954.5762,358,3958.5762,354,3954.5762" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3929.1787">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="376" y="3921.5234">Break down the bulk into indidivual transfers</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="3936.834">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="3936.834">2003</text><path d="M257,3969.5762 L331,3969.5762 L331,3976.5762 L321,3986.5762 L257,3986.5762 L257,3969.5762 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="483.3848" style="stroke: #000000; stroke-width: 2.0;" width="912" x="257" y="3969.5762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="272" y="3983.1445">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="233" x="346" y="3982.2109">[for every individual transfer in the bulk]</text><path d="M352,3991.8867 L352,4368.8867 L614,4368.8867 L614,4001.8867 L604,3991.8867 L352,3991.8867 " fill="#FFFF00" filter="url(#fpsko8sxd90ku)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M604,3991.8867 L604,4001.8867 L614,4001.8867 L604,3991.8867 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="358" y="4009.4551">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="4024.7656">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="374" y="4040.0762">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="374" y="4055.3867">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="374" y="4070.6973">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="374" y="4086.0078">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="374" y="4101.3184">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="390" y="4116.6289">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="390" y="4131.9395">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="374" y="4147.25">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="374" y="4162.5605">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="390" y="4177.8711">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="406" y="4193.1816">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="406" y="4208.4922">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="406" y="4223.8027">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="406" y="4239.1133">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="406" y="4254.4238">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="406" y="4269.7344">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="422" y="4285.0449">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="422" y="4300.3555">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="4315.666">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="4330.9766">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="4346.2871">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="4361.5977">}</text><polygon fill="#A80036" points="1052,4410.9609,1062,4414.9609,1052,4418.9609,1056,4414.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1058" y1="4414.9609" y2="4414.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="4402.5635">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="376" y="4394.9082">Route &amp; Publish Prepare event to the Payer for the Individual Transfer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="4410.2188">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="4410.2188">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="247" x2="1471" y1="4460.9609" y2="4460.9609"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="229" x="252" y="4471.5957">[Validate Bulk Prepare Transfer (failure)]</text><path d="M352,4479.916 L352,4948.916 L959,4948.916 L959,4489.916 L949,4479.916 L352,4479.916 " fill="#FFFF00" filter="url(#fpsko8sxd90ku)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M949,4479.916 L949,4489.916 L959,4489.916 L949,4479.916 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="358" y="4497.4844">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="4512.7949">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="374" y="4528.1055">id: &lt;bulkTransferMessage.bulkTransferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="374" y="4543.416">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="374" y="4558.7266">to: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="374" y="4574.0371">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="374" y="4589.3477">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="390" y="4604.6582">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="390" y="4619.9688">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="406" y="4635.2793">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="422" y="4650.5898">"errorCode": &lt;possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="422" y="4665.9004">"errorDescription": "&lt;refer to section 35.1.3 for description&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="422" y="4681.2109">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="4696.5215">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="374" y="4711.832">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="374" y="4727.1426">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="390" y="4742.4531">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="406" y="4757.7637">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="406" y="4773.0742">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="406" y="4788.3848">type: bulk-notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="406" y="4803.6953">action: bulk-abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="406" y="4819.0059">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="406" y="4834.3164">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="422" y="4849.627">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="422" y="4864.9375">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="422" y="4880.248">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="4895.5586">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="4910.8691">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="4926.1797">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="4941.4902">}</text><polygon fill="#A80036" points="1355.5,4990.8535,1365.5,4994.8535,1355.5,4998.8535,1359.5,4994.8535" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1361.5" y1="4994.8535" y2="4994.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="4982.4561">46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="376" y="4974.8008">Publish Notification (failure) event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="4990.1113">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="4990.1113">2003</text><!--
@startuml
title 1.1.1. Bulk Prepare Handler Consume

autonumber


collections "topic-bulk-prepare" as TOPIC_BULK_PREPARE
control "Bulk Prepare Handler" as BULK_PREP_HANDLER
collections "topic-transfer-prepare" as TOPIC_TRANSFER_PREPARE
collections "Event-Topic" as TOPIC_EVENTS
collections "topic-bulk-processing" as TOPIC_BULK_PROCESSING
entity "Position DAO" as POS_DAO
entity "Participant DAO" as PARTICIPANT_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_BULK_PREPARE
    participant BULK_PREP_HANDLER
    participant TOPIC_TRANSFER_PREPARE
    participant TOPIC_EVENTS
    participant TOPIC_BULK_PROCESSING
    participant POS_DAO
    participant PARTICIPANT_DAO
    participant DB
end box

activate BULK_PREP_HANDLER
group Bulk Prepare Handler Consume
    TOPIC_BULK_PREPARE <- BULK_PREP_HANDLER: Consume Bulk Prepare message
    activate TOPIC_BULK_PREPARE
    deactivate TOPIC_BULK_PREPARE

    break
        group Validate Event
            BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Validate event - Rule: type == 'bulk-prepare' && action == 'bulk-prepare'\n<color #FF0000><b>Error codes:</b> 2001</color>
        end
    end

    group Persist Event Information
        |||
        BULK_PREP_HANDLER -> TOPIC_EVENTS: Publish event information
        ref over BULK_PREP_HANDLER, TOPIC_EVENTS :  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg 9.1.0]]} \n
        |||
    end

    group Validate Bulk Prepare Transfer 
        BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: <color #AAA>Schema validation of the incoming message</color>
        BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: <color #AAA>Verify the message's signature (to be confirmed in future requirement)</color>
        note right of BULK_PREP_HANDLER #lightgrey
            The above validation steps are already handled by
            the ML-Adapter for the open source implementation.
            It may need to be added in future for custom adapters.
        end note
        group Validate Duplicate check
            BULK_PREP_HANDLER -> POS_DAO: Request to retrieve Hash for a bulkTransferId
            activate POS_DAO
            POS_DAO -> DB: Request Transfer Hash for a bulkTransferId
            activate DB
            hnote over DB #lightyellow
                bulkTransferDuplicateCheck
            end note
            POS_DAO <- - DB: Return hash if it exists
            deactivate DB
            BULK_PREP_HANDLER <- - POS_DAO: Return hash if it exists
            deactivate POS_DAO

            alt If bulkTransferId exists
                group Persist Event Information
                    |||
                    BULK_PREP_HANDLER -> TOPIC_EVENTS: Publish event information
                    ref over BULK_PREP_HANDLER, TOPIC_EVENTS :  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg 9.1.0]]} \n
                    |||
                end
                BULK_PREP_HANDLER -> BULK_PREP_HANDLER: Generate Hash for the incoming message and compare hashes

                alt BulkTransfer exists, hash matches    
                    BULK_PREP_HANDLER -> POS_DAO: Request to retrieve Bulk Transfer state \n<color #FF0000><b>Error code:</b> 2003</color>
                    activate POS_DAO
                    POS_DAO -> DB: Request BulkTransfer state
                    hnote over DB #lightyellow
                        bulkTransfer
                        bulkTransferStateChange
                    end note
                    activate DB
                    POS_DAO <- - DB: Return Transfer state
                    deactivate DB
                    POS_DAO - -> BULK_PREP_HANDLER: Return Transfer state
                    deactivate POS_DAO
                    break
                        alt If transferState IN ['COMPLETED', 'REJECTED']
                            BULK_PREP_HANDLER -> POS_DAO: Request to retrieve bulkTransferState, completedTimestamp of the bulk and\nfulfilment, completedTimestamp for each individual transferId
                            activate POS_DAO
                            POS_DAO -> DB: Request fulfilment, completedTimestamp for the transferId
                            activate DB
                            hnote over DB #lightyellow
                                bulkTransfer
                                bulkTransferAssociation
                                transferFulfilment
                            end note
                            POS_DAO <- - DB: Return completedTimestamp for bulk and\nfulfilment, completedTimestamp (if they exist) for individual transfers
                            deactivate DB
                            BULK_PREP_HANDLER <- - POS_DAO: Return completedTimestamp for bulk and\nfulfilment, completedTimestamp (if they exist) for individual transfers
                            deactivate POS_DAO
                            note right of BULK_PREP_HANDLER #yellow
                            Message:
                            {
                                id: <bulkTransferMessage.bulkTransferId>
                                from: <bulkTransferMessage.payerFsp>,
                                to: <bulkTransferMessage.payeeFsp>,
                                type: application/json
                                content: {
                                    headers: <bulkTransferHeaders>,
                                    payload: {
                                        bulkTransferState: "COMPLETED",
                                        individualTransferResults: 
                                        [ 
                                            {
                                                transferId: “b51ec534-ee48-4575-b6a9-ead2955b8069”, 
                                                fulfilment: “WLctttbu2HvTsa1XWvUoGRcQozHsqeu9Ahl2JW9Bsu8”,
                                                extensionList:
                                                {
                                                    extension:
                                                    [ 
                                                        { 
                                                            key: "key", 
                                                            “value”: value
                                                        }
                                                    ]
                                                }
                                            }
                                        ],
                                        completedTimestamp: "2019-10-24T08:38:08.699-04:00"
                                    }
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: bulk-notification,
                                        action: bulk-prepare-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "success",
                                            code: 0
                                        }
                                    }
                                }
                            }
                        end note
                            BULK_PREP_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payer with the completed bulk transfer \nFor the Data Model, refer to the Swagger (bulkTransferState - mandatory, individualTransferResults, completedTimestamp - sample values above).
                        else If transferState IN ['RECEIVED', 'PENDING', 'ACCEPTED', 'PROCESSING']
                            BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: This request can be ignored, because a callback will be sent to the client once the bulk transfer is complete.
                        else If transferState does not exist
                            BULK_PREP_HANDLER -> TOPIC_BULK_PROCESSING: Send /error callback with appropriate error message\n(Invalid duplicate request)\n<color #FF0000><b>Error code:</b> 3100</color>
                        end
                    end
                else BulkTransfer exists, hash does not match
                    break
                        BULK_PREP_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification (failure) event for Payer\n<color #FF0000><b>Error codes:</b> 3106</color> \nFor the Data Model, refer to the final step in this diagram (has the same text).
                    end
                end

            else If bulkTransferId does NOT exist
                BULK_PREP_HANDLER -> POS_DAO: Request to persist Transfer Hash \n<color #FF0000><b>Error code:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Persist Bulk Transfer message hash
                hnote over DB #lightyellow
                    bulkTransferDuplicateCheck
                end note
                POS_DAO - -> BULK_PREP_HANDLER: Return success
                deactivate POS_DAO
            end
            deactivate POS_DAO
            
        end

        group Validate Payer
            BULK_PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payer Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            hnote over DB #lightyellow
                participant
                participantCurrency
            end note
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> BULK_PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Validate Payer\n<color #FF0000><b>Error codes:</b> 3202</color>
        end
        group Validate Payee
            BULK_PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payee Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            hnote over DB #lightyellow
                participant
                participantCurrency
            end note
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> BULK_PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Validate Payee\n<color #FF0000><b>Error codes:</b> 3203</color>
        end
        BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Validate crypto-condition\n<color #FF0000><b>Error codes:</b> 3100</color>
        
        alt Validate Bulk Prepare Transfer (success)
            group Persist Bulk Transfer State (with bulktransferState='RECEIVED')
                BULK_PREP_HANDLER -> POS_DAO: Request to persist bulk transfer\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Persist bulkTransfer
                hnote over DB #lightyellow
                    bulkTransfer
                    bulkTransferParticipant
                    bulkTransferStateChange
                    bulkTransferExtension
                end note
                activate DB
                deactivate DB
                POS_DAO - -> BULK_PREP_HANDLER: Return success
                deactivate POS_DAO
            end
        else Validate Bulk Prepare Transfer (failure)
            group Persist Bulk Transfer State (with bulkTransferState='INVALID') (Introducing a new status INVALID to mark these entries)
                BULK_PREP_HANDLER -> POS_DAO: Request to persist bulk transfer\n(when Payee/Payer/crypto-condition validation fails)\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Persist transfer
                hnote over DB #lightyellow
                    bulkTransfer
                    bulkTransferParticipant
                    bulkTransferStateChange
                    bulkTransferExtension
                    bulkTransferError
                end note
                activate DB
                deactivate DB
                POS_DAO - -> BULK_PREP_HANDLER: Return success
                deactivate POS_DAO
            end
        end

    end
    alt Validate Bulk Prepare Transfer (success)
        BULK_PREP_HANDLER -> BULK_PREP_HANDLER: Break down the bulk into indidivual transfers\n<color #FF0000><b>Error codes:</b> 2003</color>
        loop for every individual transfer in the bulk
            note right of BULK_PREP_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: position,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            BULK_PREP_HANDLER -> TOPIC_TRANSFER_PREPARE: Route & Publish Prepare event to the Payer for the Individual Transfer\n<color #FF0000><b>Error codes:</b> 2003</color>
            activate TOPIC_TRANSFER_PREPARE
            deactivate TOPIC_TRANSFER_PREPARE
        end
    else Validate Bulk Prepare Transfer (failure)
        note right of BULK_PREP_HANDLER #yellow
            Message:
            {
                id: <bulkTransferMessage.bulkTransferId>
                from: <ledgerName>,
                to: <bulkTransferMessage.payerFsp>,
                type: application/json
                content: {
                    headers: <bulkTransferHeaders>,
                    payload: {
                        "errorInformation": {
                            "errorCode": <possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]>
                            "errorDescription": "<refer to section 35.1.3 for description>",
                            "extensionList": <transferMessage.extensionList>
                    }
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: bulk-notification,
                        action: bulk-abort,
                        createdAt: <timestamp>,
                        state: {
                            status: 'error',
                            code: <errorInformation.errorCode>
                            description: <errorInformation.errorDescription>
                        }
                    }
                }
            }
        end note
        BULK_PREP_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification (failure) event for Payer\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_BULK_PROCESSING
        deactivate TOPIC_BULK_PROCESSING
    end
end
deactivate BULK_PREP_HANDLER
@enduml

PlantUML version 1.2019.03(Sun Mar 10 16:34:44 IST 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_151-b12
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>