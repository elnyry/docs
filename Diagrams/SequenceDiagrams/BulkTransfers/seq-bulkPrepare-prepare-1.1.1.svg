<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="5269px" preserveAspectRatio="none" style="width:2322px;height:5269px;" version="1.1" viewBox="0 0 2322 5269" width="2322px" zoomAndPan="magnify"><defs><filter height="300%" id="ftrlu0lx8cf2v" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="265" x="1029.5" y="23.5352">1.1.1. Bulk Prepare Handler Consume</text><rect fill="#FFFFE0" height="5223.7852" style="stroke: #A80036; stroke-width: 1.0;" width="2185" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1061" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="96" y="171.9082"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="5056.498" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="337" y="126.2871"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1064" y="4550.8926"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1367.5" y="5130.7852"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="726.1875"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="1154.5352"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="1369.0195"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="1559.1934"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="91.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="2763.957"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="3530.3418"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="183.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="3804.4023"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1629" y="2923.5098"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1629" y="3178.3047"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="755.498"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="1183.8457"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="1398.3301"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="1588.5039"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="2952.8203"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="3207.6152"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="3559.6523"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="3833.7129"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="5042.498" style="stroke: #000000; stroke-width: 2.0;" width="2298" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="607" x="247" y="216.9082"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="587" x="257" y="241.2188"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="1027" x="257" y="337.1504"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="3500.873" style="stroke: #000000; stroke-width: 2.0;" width="2104" x="197" y="508.7031"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="2183.3223" style="stroke: #000000; stroke-width: 2.0;" width="2084" x="207" y="687.5664"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="2001.459" style="stroke: #000000; stroke-width: 2.0;" width="2064" x="217" y="862.4297"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="1027" x="257" y="886.7402"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="1604.7773" style="stroke: #000000; stroke-width: 2.0;" width="2044" x="227" y="1100.6035"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="1286.0957" style="stroke: #000000; stroke-width: 2.0;" width="2024" x="237" y="1306.0879"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="1254.7852" style="stroke: #000000; stroke-width: 2.0;" width="2004" x="247" y="1330.3984"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="183.1738" style="stroke: #000000; stroke-width: 2.0;" width="1973" x="257" y="1520.5723"/><rect fill="#FFFFFF" height="57.2656" style="stroke: none; stroke-width: 1.0;" width="2004" x="247" y="2453.0313"/><rect fill="#FFFFFF" height="74.8867" style="stroke: none; stroke-width: 1.0;" width="2004" x="247" y="2510.2969"/><rect fill="#FFFFFF" height="106.1973" style="stroke: none; stroke-width: 1.0;" width="2044" x="227" y="2599.1836"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="77.2422" style="stroke: #000000; stroke-width: 2.0;" width="1214" x="257" y="2621.1387"/><rect fill="#FFFFFF" height="151.5078" style="stroke: none; stroke-width: 1.0;" width="2064" x="217" y="2712.3809"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1979" x="257" y="2884.8887"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1979" x="257" y="3139.6836"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="550.4766" style="stroke: #000000; stroke-width: 2.0;" width="2016" x="247" y="3452.0996"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="229.7949" style="stroke: #000000; stroke-width: 2.0;" width="1996" x="257" y="3476.4102"/><rect fill="#FFFFFF" height="289.3711" style="stroke: none; stroke-width: 1.0;" width="2016" x="247" y="3713.2051"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="260.416" style="stroke: #000000; stroke-width: 2.0;" width="1996" x="257" y="3735.1602"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="1145.209" style="stroke: #000000; stroke-width: 2.0;" width="1224" x="247" y="4023.5762"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="483.3848" style="stroke: #000000; stroke-width: 2.0;" width="912" x="257" y="4105.5078"/><rect fill="#FFFFFF" height="572.8926" style="stroke: none; stroke-width: 1.0;" width="1224" x="247" y="4595.8926"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="101" x2="101" y1="116.2871" y2="5192.7852"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="342" x2="342" y1="116.2871" y2="5192.7852"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1069" x2="1069" y1="116.2871" y2="5192.7852"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1221" x2="1221" y1="116.2871" y2="5192.7852"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1372" x2="1372" y1="116.2871" y2="5192.7852"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1519" x2="1519" y1="116.2871" y2="5192.7852"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1634" x2="1634" y1="116.2871" y2="5192.7852"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2152" x2="2152" y1="116.2871" y2="5192.7852"/><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="27" y="76.7988"/><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="23" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="30" y="101.334">topic-bulk-prepare</text><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="27" y="5191.7852"/><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="23" y="5195.7852"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="30" y="5216.3203">topic-bulk-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="267" y="113.334">Bulk Prepare Handler</text><ellipse cx="342" cy="83.7988" fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="338,71.7988,344,66.7988,342,71.7988,344,76.7988,338,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="267" y="5205.3203">Bulk Prepare Handler</text><ellipse cx="342" cy="5224.2734" fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="338,5212.2734,344,5207.2734,342,5212.2734,344,5217.2734,338,5212.2734" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="983" y="76.7988"/><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="979" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="986" y="101.334">topic-transfer-prepare</text><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="983" y="5191.7852"/><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="979" y="5195.7852"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="986" y="5216.3203">topic-transfer-prepare</text><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1173" y="76.7988"/><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1169" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1176" y="101.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1173" y="5191.7852"/><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1169" y="5195.7852"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1176" y="5216.3203">Event-Topic</text><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="1288" y="76.7988"/><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="1284" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1291" y="101.334">topic-bulk-processing</text><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="1288" y="5191.7852"/><rect fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="1284" y="5195.7852"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1291" y="5216.3203">topic-bulk-processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1471" y="113.334">Position DAO</text><ellipse cx="1519" cy="83.7988" fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1507" x2="1531" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1471" y="5205.3203">Position DAO</text><ellipse cx="1519" cy="5224.2734" fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1507" x2="1531" y1="5238.2734" y2="5238.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1577" y="113.334">Participant DAO</text><ellipse cx="1634" cy="83.7988" fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1622" x2="1646" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1577" y="5205.3203">Participant DAO</text><ellipse cx="1634" cy="5224.2734" fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1622" x2="1646" y1="5238.2734" y2="5238.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2104" y="113.334">Central Store</text><path d="M2134,63.7988 C2134,53.7988 2152,53.7988 2152,53.7988 C2152,53.7988 2170,53.7988 2170,63.7988 L2170,89.7988 C2170,99.7988 2152,99.7988 2152,99.7988 C2152,99.7988 2134,99.7988 2134,89.7988 L2134,63.7988 " fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2134,63.7988 C2134,73.7988 2152,73.7988 2152,73.7988 C2152,73.7988 2170,73.7988 2170,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2104" y="5205.3203">Central Store</text><path d="M2134,5218.2734 C2134,5208.2734 2152,5208.2734 2152,5208.2734 C2152,5208.2734 2170,5208.2734 2170,5218.2734 L2170,5244.2734 C2170,5254.2734 2152,5254.2734 2152,5254.2734 C2152,5254.2734 2134,5254.2734 2134,5244.2734 L2134,5218.2734 " fill="#FEFECE" filter="url(#ftrlu0lx8cf2v)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2134,5218.2734 C2134,5228.2734 2152,5228.2734 2152,5228.2734 C2152,5228.2734 2170,5228.2734 2170,5218.2734 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="96" y="171.9082"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="5056.498" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="337" y="126.2871"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1064" y="4550.8926"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1367.5" y="5130.7852"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="726.1875"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="1154.5352"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="1369.0195"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="1559.1934"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="91.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="2763.957"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="3530.3418"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="183.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1514" y="3804.4023"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1629" y="2923.5098"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1629" y="3178.3047"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="755.498"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="1183.8457"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="1398.3301"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="1588.5039"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="2952.8203"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="3207.6152"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="3559.6523"/><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2147" y="3833.7129"/><path d="M13,133.2871 L269,133.2871 L269,140.2871 L259,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="5042.498" style="stroke: #000000; stroke-width: 2.0;" width="2298" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="211" x="28" y="146.8555">Bulk Prepare Handler Consume</text><polygon fill="#A80036" points="117,167.9082,107,171.9082,117,175.9082,113,171.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111" x2="336" y1="171.9082" y2="171.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="123" y="167.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="136" y="167.166">Consume Bulk Prepare message</text><path d="M247,216.9082 L331,216.9082 L331,223.9082 L321,233.9082 L247,233.9082 L247,216.9082 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="607" x="247" y="216.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="262" y="230.4766">break</text><path d="M257,241.2188 L399,241.2188 L399,248.2188 L389,258.2188 L257,258.2188 L257,241.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="587" x="257" y="241.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="272" y="254.7871">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="295.1504" y2="295.1504"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="295.1504" y2="308.1504"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="308.1504" y2="308.1504"/><polygon fill="#A80036" points="358,304.1504,348,308.1504,358,312.1504,354,308.1504" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="354" y="282.7529">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="465" x="367" y="275.0977">Validate event - Rule: type == 'bulk-prepare' &amp;&amp; action == 'bulk-prepare'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="367" y="290.4082">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="451" y="290.4082">2001</text><path d="M257,337.1504 L472,337.1504 L472,344.1504 L462,354.1504 L257,354.1504 L257,337.1504 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="1027" x="257" y="337.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="272" y="350.7188">Persist Event Information</text><polygon fill="#A80036" points="1209.5,396.7715,1219.5,400.7715,1209.5,404.7715,1213.5,400.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1215.5" y1="400.7715" y2="400.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="354" y="396.0293">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="367" y="396.0293">Publish event information</text><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="1009" x="264" y="408.7715"/><polygon fill="#EEEEEE" points="264,408.7715,328,408.7715,328,415.7715,318,425.7715,264,425.7715,264,408.7715" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="277" y="423.3398">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="671.5" y="442.3398">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="32" x="829.5" y="442.3398">9.1.0</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="829.5" x2="861.5" y1="444.3398" y2="444.3398"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="861.5" y="442.3398">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="675.5" y="457.6504"/><path d="M197,508.7031 L449,508.7031 L449,515.7031 L439,525.7031 L197,525.7031 L197,508.7031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3500.873" style="stroke: #000000; stroke-width: 2.0;" width="2104" x="197" y="508.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="212" y="522.2715">Validate Bulk Prepare Transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="547.3242" y2="547.3242"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="547.3242" y2="560.3242"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="560.3242" y2="560.3242"/><polygon fill="#A80036" points="358,556.3242,348,560.3242,358,564.3242,354,560.3242" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="354" y="542.582">4</text><text fill="#AAAAAA" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="367" y="542.582">Schema validation of the incoming message</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="589.6348" y2="589.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="589.6348" y2="602.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="602.6348" y2="602.6348"/><polygon fill="#A80036" points="358,598.6348,348,602.6348,358,606.6348,354,602.6348" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="354" y="584.8926">5</text><text fill="#AAAAAA" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="442" x="367" y="584.8926">Verify the message's signature (to be confirmed in future requirement)</text><path d="M352,615.6348 L352,670.6348 L717,670.6348 L717,625.6348 L707,615.6348 L352,615.6348 " fill="#D3D3D3" filter="url(#ftrlu0lx8cf2v)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M707,615.6348 L707,625.6348 L717,625.6348 L707,615.6348 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="358" y="633.2031">The above validation steps are already handled by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="358" y="648.5137">the ML-Adapter for the open source implementation.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="358" y="663.8242">It may need to be added in future for custom adapters.</text><path d="M207,687.5664 L418,687.5664 L418,694.5664 L408,704.5664 L207,704.5664 L207,687.5664 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2183.3223" style="stroke: #000000; stroke-width: 2.0;" width="2084" x="207" y="687.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="166" x="222" y="701.1348">Validate Duplicate check</text><polygon fill="#A80036" points="1502,722.1875,1512,726.1875,1502,730.1875,1506,726.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="726.1875" y2="726.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="354" y="721.4453">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="367" y="721.4453">Request to retrieve Hash for a bulkTransferId</text><polygon fill="#A80036" points="2135,751.498,2145,755.498,2135,759.498,2139,755.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2141" y1="755.498" y2="755.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1531" y="750.7559">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="271" x="1544" y="750.7559">Request Transfer Hash for a bulkTransferId</text><polygon fill="#FFFFE0" filter="url(#ftrlu0lx8cf2v)" points="2060,768.498,2243,768.498,2253,779.498,2243,791.498,2060,791.498,2050,779.498,2060,768.498" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="2062" y="785.0664">bulkTransferDuplicateCheck</text><polygon fill="#A80036" points="1535,814.1191,1525,818.1191,1535,822.1191,1531,818.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1529" x2="2151" y1="818.1191" y2="818.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1541" y="813.377">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="1554" y="813.377">Return hash if it exists</text><polygon fill="#A80036" points="358,843.4297,348,847.4297,358,851.4297,354,847.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="847.4297" y2="847.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="364" y="842.6875">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="377" y="842.6875">Return hash if it exists</text><path d="M217,862.4297 L279,862.4297 L279,869.4297 L269,879.4297 L217,879.4297 L217,862.4297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2001.459" style="stroke: #000000; stroke-width: 2.0;" width="2064" x="217" y="862.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="232" y="875.998">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141" x="294" y="875.0645">[If bulkTransferId exists]</text><path d="M257,886.7402 L472,886.7402 L472,893.7402 L462,903.7402 L257,903.7402 L257,886.7402 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="1027" x="257" y="886.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="272" y="900.3086">Persist Event Information</text><polygon fill="#A80036" points="1209.5,946.3613,1219.5,950.3613,1209.5,954.3613,1213.5,950.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1215.5" y1="950.3613" y2="950.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="945.6191">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="376" y="945.6191">Publish event information</text><rect fill="#FFFFFF" filter="url(#ftrlu0lx8cf2v)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="1009" x="264" y="958.3613"/><polygon fill="#EEEEEE" points="264,958.3613,328,958.3613,328,965.3613,318,975.3613,264,975.3613,264,958.3613" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="277" y="972.9297">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="671.5" y="991.9297">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="32" x="829.5" y="991.9297">9.1.0</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="829.5" x2="861.5" y1="993.9297" y2="993.9297"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="861.5" y="991.9297">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="675.5" y="1007.2402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="1072.6035" y2="1072.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="1072.6035" y2="1085.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="1085.6035" y2="1085.6035"/><polygon fill="#A80036" points="358,1081.6035,348,1085.6035,358,1089.6035,354,1085.6035" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="1067.8613">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="376" y="1067.8613">Generate Hash for the incoming message and compare hashes</text><path d="M227,1100.6035 L289,1100.6035 L289,1107.6035 L279,1117.6035 L227,1117.6035 L227,1100.6035 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1604.7773" style="stroke: #000000; stroke-width: 2.0;" width="2044" x="227" y="1100.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="242" y="1114.1719">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="200" x="304" y="1113.2383">[BulkTransfer exists, hash matches]</text><polygon fill="#A80036" points="1502,1150.5352,1512,1154.5352,1502,1158.5352,1506,1154.5352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="1154.5352" y2="1154.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="1142.1377">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="376" y="1134.4824">Request to retrieve Bulk Transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="376" y="1149.793">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="453" y="1149.793">2003</text><polygon fill="#A80036" points="2135,1179.8457,2145,1183.8457,2135,1187.8457,2139,1183.8457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2141" y1="1183.8457" y2="1183.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1531" y="1179.1035">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="1553" y="1179.1035">Request BulkTransfer state</text><polygon fill="#FFFFE0" filter="url(#ftrlu0lx8cf2v)" points="2071,1196.8457,2233,1196.8457,2243,1215.8457,2233,1234.8457,2071,1234.8457,2061,1215.8457,2071,1196.8457" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="2073" y="1213.4141">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="2073" y="1228.7246">bulkTransferStateChange</text><polygon fill="#A80036" points="1535,1257.7773,1525,1261.7773,1535,1265.7773,1531,1261.7773" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1529" x2="2151" y1="1261.7773" y2="1261.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1541" y="1257.0352">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="1563" y="1257.0352">Return Transfer state</text><polygon fill="#A80036" points="358,1287.0879,348,1291.0879,358,1295.0879,354,1291.0879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="1291.0879" y2="1291.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="1286.3457">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="386" y="1286.3457">Return Transfer state</text><path d="M237,1306.0879 L321,1306.0879 L321,1313.0879 L311,1323.0879 L237,1323.0879 L237,1306.0879 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1286.0957" style="stroke: #000000; stroke-width: 2.0;" width="2024" x="237" y="1306.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="252" y="1319.6563">break</text><path d="M247,1330.3984 L309,1330.3984 L309,1337.3984 L299,1347.3984 L247,1347.3984 L247,1330.3984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1254.7852" style="stroke: #000000; stroke-width: 2.0;" width="2004" x="247" y="1330.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="262" y="1343.9668">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="297" x="324" y="1343.0332">[If bulkTransferState IN ['COMPLETED', 'REJECTED']]</text><polygon fill="#A80036" points="1502,1365.0195,1512,1369.0195,1502,1373.0195,1506,1369.0195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="1369.0195" y2="1369.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="1364.2773">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="684" x="376" y="1364.2773">Request to retrieve bulkTransferState, completedTimestamp of the bulk and the individual transfers involved</text><polygon fill="#A80036" points="2135,1394.3301,2145,1398.3301,2135,1402.3301,2139,1398.3301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2141" y1="1398.3301" y2="1398.3301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1531" y="1393.5879">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="577" x="1553" y="1393.5879">Return bulk transfer state, completedTimestamp for bulk and the list of individual transfers</text><polygon fill="#FFFFE0" filter="url(#ftrlu0lx8cf2v)" points="2073,1411.3301,2231,1411.3301,2241,1430.3301,2231,1449.3301,2073,1449.3301,2063,1430.3301,2073,1411.3301" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="2075" y="1427.8984">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="2075" y="1443.209">bulkTransferAssociation</text><polygon fill="#A80036" points="1535,1472.2617,1525,1476.2617,1535,1480.2617,1531,1476.2617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1529" x2="2151" y1="1476.2617" y2="1476.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1541" y="1471.5195">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="577" x="1563" y="1471.5195">Return bulk transfer state, completedTimestamp for bulk and the list of individual transfers</text><polygon fill="#A80036" points="358,1501.5723,348,1505.5723,358,1509.5723,354,1505.5723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="1505.5723" y2="1505.5723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="1500.8301">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="453" x="386" y="1500.8301">Return completedTimestamp for bulk and the list of individual transfers</text><path d="M257,1520.5723 L331,1520.5723 L331,1527.5723 L321,1537.5723 L257,1537.5723 L257,1520.5723 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="183.1738" style="stroke: #000000; stroke-width: 2.0;" width="1973" x="257" y="1520.5723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="272" y="1534.1406">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="228" x="346" y="1533.207">[for each individual transfer in the bulk]</text><polygon fill="#A80036" points="1502,1555.1934,1512,1559.1934,1502,1563.1934,1506,1559.1934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="1559.1934" y2="1559.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="1554.4512">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="514" x="376" y="1554.4512">Request to retrieve fulfilment, completedTimestamp for each individual transferId</text><polygon fill="#A80036" points="2135,1584.5039,2145,1588.5039,2135,1592.5039,2139,1588.5039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2141" y1="1588.5039" y2="1588.5039"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1531" y="1583.7617">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="1553" y="1583.7617">Request fulfilment, completedTimestamp for the transferId</text><polygon fill="#FFFFE0" filter="url(#ftrlu0lx8cf2v)" points="2093,1601.5039,2210,1601.5039,2220,1620.5039,2210,1639.5039,2093,1639.5039,2083,1620.5039,2093,1601.5039" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="2095" y="1618.0723">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="2095" y="1633.3828">transferFulfilment</text><polygon fill="#A80036" points="1535,1662.4355,1525,1666.4355,1535,1670.4355,1531,1666.4355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1529" x2="2151" y1="1666.4355" y2="1666.4355"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1541" y="1661.6934">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="486" x="1563" y="1661.6934">Return fulfilment, completedTimestamp (if they exist) for individual transfers</text><polygon fill="#A80036" points="358,1691.7461,348,1695.7461,358,1699.7461,354,1695.7461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="1695.7461" y2="1695.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="1691.0039">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="486" x="386" y="1691.0039">Return fulfilment, completedTimestamp (if they exist) for individual transfers</text><path d="M352,1715.7461 L352,2398.7461 L870,2398.7461 L870,1725.7461 L860,1715.7461 L352,1715.7461 " fill="#FFFF00" filter="url(#ftrlu0lx8cf2v)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M860,1715.7461 L860,1725.7461 L870,1725.7461 L860,1715.7461 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="358" y="1733.3145">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="1748.625">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="374" y="1763.9355">id: &lt;bulkTransferMessage.bulkTransferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="374" y="1779.2461">from: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="374" y="1794.5566">to: &lt;bulkTransferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="374" y="1809.8672">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="374" y="1825.1777">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="390" y="1840.4883">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="390" y="1855.7988">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="406" y="1871.1094">bulkTransferState: "COMPLETED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="406" y="1886.4199">individualTransferResults:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="1901.7305">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="1917.041">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="438" y="1932.3516">transferId: “b51ec534-ee48-4575-b6a9-ead2955b8069”,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="417" x="438" y="1947.6621">fulfilment: “WLctttbu2HvTsa1XWvUoGRcQozHsqeu9Ahl2JW9Bsu8”,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="438" y="1962.9727">extensionList:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="438" y="1978.2832">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="454" y="1993.5938">extension:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="454" y="2008.9043">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="470" y="2024.2148">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="486" y="2039.5254">key: "key",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="486" y="2054.8359">“value”: value</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="470" y="2070.1465">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="454" y="2085.457">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="438" y="2100.7676">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="2116.0781">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="406" y="2131.3887">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="406" y="2146.6992">completedTimestamp: "2019-10-24T08:38:08.699-04:00"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="2162.0098">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="374" y="2177.3203">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="374" y="2192.6309">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="390" y="2207.9414">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="406" y="2223.252">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="406" y="2238.5625">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="406" y="2253.873">type: bulk-notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="406" y="2269.1836">action: bulk-prepare-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="406" y="2284.4941">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="406" y="2299.8047">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="422" y="2315.1152">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="422" y="2330.4258">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="2345.7363">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="2361.0469">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="2376.3574">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="2391.668">}</text><polygon fill="#A80036" points="1360.5,2441.0313,1370.5,2445.0313,1360.5,2449.0313,1364.5,2445.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1366.5" y1="2445.0313" y2="2445.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2432.6338">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="432" x="376" y="2424.9785">Publish Notification event for Payer with the completed bulk transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="921" x="376" y="2440.2891">For the Data Model, refer to the Swagger (bulkTransferState - mandatory, individualTransferResults, completedTimestamp - sample values above).</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="247" x2="2251" y1="2454.0313" y2="2454.0313"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="406" x="252" y="2464.666">[If transferState IN ['RECEIVED', 'PENDING', 'ACCEPTED', 'PROCESSING']]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="2489.2969" y2="2489.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="2489.2969" y2="2502.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="2502.2969" y2="2502.2969"/><polygon fill="#A80036" points="358,2498.2969,348,2502.2969,358,2506.2969,354,2502.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2484.5547">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="681" x="376" y="2484.5547">This request can be ignored, because a callback will be sent to the client once the bulk transfer is complete.</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="247" x2="2251" y1="2511.2969" y2="2511.2969"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="252" y="2521.9316">[If transferState does not exist]</text><polygon fill="#A80036" points="1360.5,2573.1836,1370.5,2577.1836,1360.5,2581.1836,1364.5,2577.1836" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1366.5" y1="2577.1836" y2="2577.1836"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2557.1309">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="376" y="2541.8203">Send /error callback with appropriate error message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="376" y="2557.1309">(Invalid duplicate request)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="376" y="2572.4414">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="453" y="2572.4414">3100</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="227" x2="2271" y1="2600.1836" y2="2600.1836"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="232" y="2610.8184">[BulkTransfer exists, hash does not match]</text><path d="M257,2621.1387 L341,2621.1387 L341,2628.1387 L331,2638.1387 L257,2638.1387 L257,2621.1387 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="77.2422" style="stroke: #000000; stroke-width: 2.0;" width="1214" x="257" y="2621.1387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="272" y="2634.707">break</text><polygon fill="#A80036" points="1360.5,2686.3809,1370.5,2690.3809,1360.5,2694.3809,1364.5,2690.3809" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1366.5" y1="2690.3809" y2="2690.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2670.3281">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="376" y="2655.0176">Publish Notification (failure) event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="2670.3281">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="2670.3281">3106</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="496" y="2670.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="487" x="376" y="2685.6387">For the Data Model, refer to the final step in this diagram (has the same text).</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="217" x2="2281" y1="2713.3809" y2="2713.3809"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="194" x="222" y="2724.0156">[If bulkTransferId does NOT exist]</text><polygon fill="#A80036" points="1502,2759.957,1512,2763.957,1502,2767.957,1506,2763.957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="2763.957" y2="2763.957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2751.5596">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="376" y="2743.9043">Request to persist Transfer Hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="376" y="2759.2148">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="453" y="2759.2148">2003</text><polygon fill="#A80036" points="2140,2789.2676,2150,2793.2676,2140,2797.2676,2144,2793.2676" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2146" y1="2793.2676" y2="2793.2676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1531" y="2788.5254">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="1553" y="2788.5254">Persist Bulk Transfer message hash</text><polygon fill="#FFFFE0" filter="url(#ftrlu0lx8cf2v)" points="2060,2806.2676,2243,2806.2676,2253,2817.2676,2243,2829.2676,2060,2829.2676,2050,2817.2676,2060,2806.2676" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="2062" y="2822.8359">bulkTransferDuplicateCheck</text><polygon fill="#A80036" points="358,2851.8887,348,2855.8887,358,2859.8887,354,2855.8887" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="2855.8887" y2="2855.8887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="2851.1465">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="386" y="2851.1465">Return success</text><path d="M257,2884.8887 L399,2884.8887 L399,2891.8887 L389,2901.8887 L257,2901.8887 L257,2884.8887 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1979" x="257" y="2884.8887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="272" y="2898.457">Validate Payer</text><polygon fill="#A80036" points="1617,2919.5098,1627,2923.5098,1617,2927.5098,1621,2923.5098" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1623" y1="2923.5098" y2="2923.5098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="2918.7676">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="376" y="2918.7676">Request to retrieve Payer Participant details (if it exists)</text><polygon fill="#A80036" points="2135,2948.8203,2145,2952.8203,2135,2956.8203,2139,2952.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1639" x2="2141" y1="2952.8203" y2="2952.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1646" y="2948.0781">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1668" y="2948.0781">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#ftrlu0lx8cf2v)" points="2088,2965.8203,2216,2965.8203,2226,2984.8203,2216,3003.8203,2088,3003.8203,2078,2984.8203,2088,2965.8203" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="2090" y="2982.3887">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="2090" y="2997.6992">participantCurrency</text><polygon fill="#A80036" points="1650,3026.752,1640,3030.752,1650,3034.752,1646,3030.752" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1644" x2="2151" y1="3030.752" y2="3030.752"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1656" y="3026.0098">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1678" y="3026.0098">Return Participant details if it exists</text><polygon fill="#A80036" points="358,3056.0625,348,3060.0625,358,3064.0625,354,3060.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1633" y1="3060.0625" y2="3060.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="3055.3203">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="386" y="3055.3203">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="3104.6836" y2="3104.6836"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="3104.6836" y2="3117.6836"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="3117.6836" y2="3117.6836"/><polygon fill="#A80036" points="358,3113.6836,348,3117.6836,358,3121.6836,354,3117.6836" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3092.2861">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="376" y="3084.6309">Validate Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="3099.9414">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="3099.9414">3202</text><path d="M257,3139.6836 L401,3139.6836 L401,3146.6836 L391,3156.6836 L257,3156.6836 L257,3139.6836 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1979" x="257" y="3139.6836"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="272" y="3153.252">Validate Payee</text><polygon fill="#A80036" points="1617,3174.3047,1627,3178.3047,1617,3182.3047,1621,3178.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1623" y1="3178.3047" y2="3178.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3173.5625">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="376" y="3173.5625">Request to retrieve Payee Participant details (if it exists)</text><polygon fill="#A80036" points="2135,3203.6152,2145,3207.6152,2135,3211.6152,2139,3207.6152" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1639" x2="2141" y1="3207.6152" y2="3207.6152"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1646" y="3202.873">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1668" y="3202.873">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#ftrlu0lx8cf2v)" points="2088,3220.6152,2216,3220.6152,2226,3239.6152,2216,3258.6152,2088,3258.6152,2078,3239.6152,2088,3220.6152" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="2090" y="3237.1836">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="2090" y="3252.4941">participantCurrency</text><polygon fill="#A80036" points="1650,3281.5469,1640,3285.5469,1650,3289.5469,1646,3285.5469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1644" x2="2151" y1="3285.5469" y2="3285.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1656" y="3280.8047">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1678" y="3280.8047">Return Participant details if it exists</text><polygon fill="#A80036" points="358,3310.8574,348,3314.8574,358,3318.8574,354,3314.8574" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1633" y1="3314.8574" y2="3314.8574"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="3310.1152">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="386" y="3310.1152">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="3359.4785" y2="3359.4785"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="3359.4785" y2="3372.4785"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="3372.4785" y2="3372.4785"/><polygon fill="#A80036" points="358,3368.4785,348,3372.4785,358,3376.4785,354,3372.4785" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3347.0811">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="376" y="3339.4258">Validate Payee</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="3354.7363">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="3354.7363">3203</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="3424.0996" y2="3424.0996"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="3424.0996" y2="3437.0996"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="3437.0996" y2="3437.0996"/><polygon fill="#A80036" points="358,3433.0996,348,3437.0996,358,3441.0996,354,3437.0996" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3411.7021">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="376" y="3404.0469">Validate crypto-condition</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="3419.3574">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="3419.3574">3100</text><path d="M247,3452.0996 L309,3452.0996 L309,3459.0996 L299,3469.0996 L247,3469.0996 L247,3452.0996 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="550.4766" style="stroke: #000000; stroke-width: 2.0;" width="2016" x="247" y="3452.0996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="262" y="3465.668">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="324" y="3464.7344">[Validate Bulk Prepare Transfer (success)]</text><path d="M257,3476.4102 L724,3476.4102 L724,3483.4102 L714,3493.4102 L257,3493.4102 L257,3476.4102 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="229.7949" style="stroke: #000000; stroke-width: 2.0;" width="1996" x="257" y="3476.4102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="422" x="272" y="3489.9785">Persist Bulk Transfer State (with bulktransferState='RECEIVED')</text><polygon fill="#A80036" points="1502,3526.3418,1512,3530.3418,1502,3534.3418,1506,3530.3418" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="3530.3418" y2="3530.3418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3517.9443">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="376" y="3510.2891">Request to persist bulk transfer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="3525.5996">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="3525.5996">2003</text><polygon fill="#A80036" points="2135,3555.6523,2145,3559.6523,2135,3563.6523,2139,3559.6523" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2141" y1="3559.6523" y2="3559.6523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1531" y="3554.9102">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="1553" y="3554.9102">Persist bulkTransfer</text><polygon fill="#FFFFE0" filter="url(#ftrlu0lx8cf2v)" points="2071,3602.6523,2233,3602.6523,2243,3636.6523,2233,3671.6523,2071,3671.6523,2061,3636.6523,2071,3602.6523" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="2073" y="3619.2207">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="2073" y="3634.5313">bulkTransferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="2073" y="3649.8418">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="2073" y="3665.1523">bulkTransferExtension</text><polygon fill="#A80036" points="358,3694.2051,348,3698.2051,358,3702.2051,354,3698.2051" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="3698.2051" y2="3698.2051"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="3693.4629">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="386" y="3693.4629">Return success</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="247" x2="2263" y1="3714.2051" y2="3714.2051"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="229" x="252" y="3724.8398">[Validate Bulk Prepare Transfer (failure)]</text><path d="M257,3735.1602 L1107,3735.1602 L1107,3742.1602 L1097,3752.1602 L257,3752.1602 L257,3735.1602 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="260.416" style="stroke: #000000; stroke-width: 2.0;" width="1996" x="257" y="3735.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="805" x="272" y="3748.7285">Persist Bulk Transfer State (with bulkTransferState='INVALID') (Introducing a new status INVALID to mark these entries)</text><polygon fill="#A80036" points="1502,3800.4023,1512,3804.4023,1502,3808.4023,1506,3804.4023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1508" y1="3804.4023" y2="3804.4023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="3784.3496">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="376" y="3769.0391">Request to persist bulk transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="376" y="3784.3496">(when Payee/Payer/crypto-condition validation fails)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="3799.6602">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="3799.6602">2003</text><polygon fill="#A80036" points="2135,3829.7129,2145,3833.7129,2135,3837.7129,2139,3833.7129" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1524" x2="2141" y1="3833.7129" y2="3833.7129"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1531" y="3828.9707">46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1553" y="3828.9707">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#ftrlu0lx8cf2v)" points="2071,3876.7129,2233,3876.7129,2243,3918.7129,2233,3960.7129,2071,3960.7129,2061,3918.7129,2071,3876.7129" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="2073" y="3893.2813">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="2073" y="3908.5918">bulkTransferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="2073" y="3923.9023">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="2073" y="3939.2129">bulkTransferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="2073" y="3954.5234">bulkTransferError</text><polygon fill="#A80036" points="358,3983.5762,348,3987.5762,358,3991.5762,354,3987.5762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="352" x2="1518" y1="3987.5762" y2="3987.5762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="364" y="3982.834">47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="386" y="3982.834">Return success</text><path d="M247,4023.5762 L309,4023.5762 L309,4030.5762 L299,4040.5762 L247,4040.5762 L247,4023.5762 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1145.209" style="stroke: #000000; stroke-width: 2.0;" width="1224" x="247" y="4023.5762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="262" y="4037.1445">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="324" y="4036.2109">[Validate Bulk Prepare Transfer (success)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="389" y1="4077.5078" y2="4077.5078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="389" y1="4077.5078" y2="4090.5078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="389" y1="4090.5078" y2="4090.5078"/><polygon fill="#A80036" points="358,4086.5078,348,4090.5078,358,4094.5078,354,4090.5078" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="4065.1104">48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="376" y="4057.4551">Break down the bulk into indidivual transfers</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="4072.7656">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="4072.7656">2003</text><path d="M257,4105.5078 L331,4105.5078 L331,4112.5078 L321,4122.5078 L257,4122.5078 L257,4105.5078 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="483.3848" style="stroke: #000000; stroke-width: 2.0;" width="912" x="257" y="4105.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="272" y="4119.0762">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="233" x="346" y="4118.1426">[for every individual transfer in the bulk]</text><path d="M352,4127.8184 L352,4504.8184 L614,4504.8184 L614,4137.8184 L604,4127.8184 L352,4127.8184 " fill="#FFFF00" filter="url(#ftrlu0lx8cf2v)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M604,4127.8184 L604,4137.8184 L614,4137.8184 L604,4127.8184 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="358" y="4145.3867">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="4160.6973">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="374" y="4176.0078">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="374" y="4191.3184">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="374" y="4206.6289">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="374" y="4221.9395">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="374" y="4237.25">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="390" y="4252.5605">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="390" y="4267.8711">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="374" y="4283.1816">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="374" y="4298.4922">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="390" y="4313.8027">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="406" y="4329.1133">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="406" y="4344.4238">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="406" y="4359.7344">type: bulk-prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="406" y="4375.0449">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="406" y="4390.3555">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="406" y="4405.666">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="422" y="4420.9766">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="422" y="4436.2871">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="4451.5977">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="4466.9082">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="4482.2188">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="4497.5293">}</text><polygon fill="#A80036" points="1052,4546.8926,1062,4550.8926,1052,4554.8926,1056,4550.8926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1058" y1="4550.8926" y2="4550.8926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="4538.4951">49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="376" y="4530.8398">Route &amp; Publish Prepare event to the Payer for the Individual Transfer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="4546.1504">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="4546.1504">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="247" x2="1471" y1="4596.8926" y2="4596.8926"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="229" x="252" y="4607.5273">[Validate Bulk Prepare Transfer (failure)]</text><path d="M352,4615.8477 L352,5084.8477 L959,5084.8477 L959,4625.8477 L949,4615.8477 L352,4615.8477 " fill="#FFFF00" filter="url(#ftrlu0lx8cf2v)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M949,4615.8477 L949,4625.8477 L959,4625.8477 L949,4615.8477 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="358" y="4633.416">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="4648.7266">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="374" y="4664.0371">id: &lt;bulkTransferMessage.bulkTransferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="374" y="4679.3477">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="374" y="4694.6582">to: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="374" y="4709.9688">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="374" y="4725.2793">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="390" y="4740.5898">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="390" y="4755.9004">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="406" y="4771.2109">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="422" y="4786.5215">"errorCode": &lt;possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="422" y="4801.832">"errorDescription": "&lt;refer to section 35.1.3 for description&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="422" y="4817.1426">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="4832.4531">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="374" y="4847.7637">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="374" y="4863.0742">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="390" y="4878.3848">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="406" y="4893.6953">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="406" y="4909.0059">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="406" y="4924.3164">type: bulk-notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="406" y="4939.627">action: bulk-abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="406" y="4954.9375">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="406" y="4970.248">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="422" y="4985.5586">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="422" y="5000.8691">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="422" y="5016.1797">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="5031.4902">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="5046.8008">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="5062.1113">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="5077.4219">}</text><polygon fill="#A80036" points="1355.5,5126.7852,1365.5,5130.7852,1355.5,5134.7852,1359.5,5130.7852" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="1361.5" y1="5130.7852" y2="5130.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="354" y="5118.3877">50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="376" y="5110.7324">Publish Notification (failure) event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="5126.043">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="5126.043">2003</text><!--
@startuml
title 1.1.1. Bulk Prepare Handler Consume

autonumber


collections "topic-bulk-prepare" as TOPIC_BULK_PREPARE
control "Bulk Prepare Handler" as BULK_PREP_HANDLER
collections "topic-transfer-prepare" as TOPIC_TRANSFER_PREPARE
collections "Event-Topic" as TOPIC_EVENTS
collections "topic-bulk-processing" as TOPIC_BULK_PROCESSING
entity "Position DAO" as POS_DAO
entity "Participant DAO" as PARTICIPANT_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_BULK_PREPARE
    participant BULK_PREP_HANDLER
    participant TOPIC_TRANSFER_PREPARE
    participant TOPIC_EVENTS
    participant TOPIC_BULK_PROCESSING
    participant POS_DAO
    participant PARTICIPANT_DAO
    participant DB
end box

activate BULK_PREP_HANDLER
group Bulk Prepare Handler Consume
    TOPIC_BULK_PREPARE <- BULK_PREP_HANDLER: Consume Bulk Prepare message
    activate TOPIC_BULK_PREPARE
    deactivate TOPIC_BULK_PREPARE

    break
        group Validate Event
            BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Validate event - Rule: type == 'bulk-prepare' && action == 'bulk-prepare'\n<color #FF0000><b>Error codes:</b> 2001</color>
        end
    end

    group Persist Event Information
        |||
        BULK_PREP_HANDLER -> TOPIC_EVENTS: Publish event information
        ref over BULK_PREP_HANDLER, TOPIC_EVENTS :  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg 9.1.0]]} \n
        |||
    end

    group Validate Bulk Prepare Transfer 
        BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: <color #AAA>Schema validation of the incoming message</color>
        BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: <color #AAA>Verify the message's signature (to be confirmed in future requirement)</color>
        note right of BULK_PREP_HANDLER #lightgrey
            The above validation steps are already handled by
            the ML-Adapter for the open source implementation.
            It may need to be added in future for custom adapters.
        end note
        group Validate Duplicate check
            BULK_PREP_HANDLER -> POS_DAO: Request to retrieve Hash for a bulkTransferId
            activate POS_DAO
            POS_DAO -> DB: Request Transfer Hash for a bulkTransferId
            activate DB
            hnote over DB #lightyellow
                bulkTransferDuplicateCheck
            end note
            POS_DAO <- - DB: Return hash if it exists
            deactivate DB
            BULK_PREP_HANDLER <- - POS_DAO: Return hash if it exists
            deactivate POS_DAO

            alt If bulkTransferId exists
                group Persist Event Information
                    |||
                    BULK_PREP_HANDLER -> TOPIC_EVENTS: Publish event information
                    ref over BULK_PREP_HANDLER, TOPIC_EVENTS :  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg 9.1.0]]} \n
                    |||
                end
                BULK_PREP_HANDLER -> BULK_PREP_HANDLER: Generate Hash for the incoming message and compare hashes

                alt BulkTransfer exists, hash matches    
                    BULK_PREP_HANDLER -> POS_DAO: Request to retrieve Bulk Transfer state \n<color #FF0000><b>Error code:</b> 2003</color>
                    activate POS_DAO
                    POS_DAO -> DB: Request BulkTransfer state
                    hnote over DB #lightyellow
                        bulkTransfer
                        bulkTransferStateChange
                    end note
                    activate DB
                    POS_DAO <- - DB: Return Transfer state
                    deactivate DB
                    POS_DAO - -> BULK_PREP_HANDLER: Return Transfer state
                    deactivate POS_DAO
                    break
                        alt If bulkTransferState IN ['COMPLETED', 'REJECTED']
                            BULK_PREP_HANDLER -> POS_DAO: Request to retrieve bulkTransferState, completedTimestamp of the bulk and the individual transfers involved
                            activate POS_DAO
                            POS_DAO -> DB: Return bulk transfer state, completedTimestamp for bulk and the list of individual transfers
                            activate DB
                            hnote over DB #lightyellow
                                bulkTransfer
                                bulkTransferAssociation
                            end note
                            POS_DAO <- - DB: Return bulk transfer state, completedTimestamp for bulk and the list of individual transfers
                            deactivate DB
                            BULK_PREP_HANDLER <- - POS_DAO: Return completedTimestamp for bulk and the list of individual transfers
                            deactivate POS_DAO
                            loop for each individual transfer in the bulk
                                BULK_PREP_HANDLER -> POS_DAO: Request to retrieve fulfilment, completedTimestamp for each individual transferId
                                activate POS_DAO
                                POS_DAO -> DB: Request fulfilment, completedTimestamp for the transferId
                                activate DB
                                hnote over DB #lightyellow
                                    transfer
                                    transferFulfilment
                                end note
                                POS_DAO <- - DB: Return fulfilment, completedTimestamp (if they exist) for individual transfers
                                deactivate DB
                                BULK_PREP_HANDLER <- - POS_DAO: Return fulfilment, completedTimestamp (if they exist) for individual transfers
                                deactivate POS_DAO
                            end
                            note right of BULK_PREP_HANDLER #yellow
                            Message:
                            {
                                id: <bulkTransferMessage.bulkTransferId>
                                from: <bulkTransferMessage.payerFsp>,
                                to: <bulkTransferMessage.payeeFsp>,
                                type: application/json
                                content: {
                                    headers: <bulkTransferHeaders>,
                                    payload: {
                                        bulkTransferState: "COMPLETED",
                                        individualTransferResults: 
                                        [ 
                                            {
                                                transferId: “b51ec534-ee48-4575-b6a9-ead2955b8069”, 
                                                fulfilment: “WLctttbu2HvTsa1XWvUoGRcQozHsqeu9Ahl2JW9Bsu8”,
                                                extensionList:
                                                {
                                                    extension:
                                                    [ 
                                                        { 
                                                            key: "key", 
                                                            “value”: value
                                                        }
                                                    ]
                                                }
                                            }
                                        ],
                                        completedTimestamp: "2019-10-24T08:38:08.699-04:00"
                                    }
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: bulk-notification,
                                        action: bulk-prepare-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "success",
                                            code: 0
                                        }
                                    }
                                }
                            }
                        end note
                            BULK_PREP_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payer with the completed bulk transfer \nFor the Data Model, refer to the Swagger (bulkTransferState - mandatory, individualTransferResults, completedTimestamp - sample values above).
                        else If transferState IN ['RECEIVED', 'PENDING', 'ACCEPTED', 'PROCESSING']
                            BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: This request can be ignored, because a callback will be sent to the client once the bulk transfer is complete.
                        else If transferState does not exist
                            BULK_PREP_HANDLER -> TOPIC_BULK_PROCESSING: Send /error callback with appropriate error message\n(Invalid duplicate request)\n<color #FF0000><b>Error code:</b> 3100</color>
                        end
                    end
                else BulkTransfer exists, hash does not match
                    break
                        BULK_PREP_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification (failure) event for Payer\n<color #FF0000><b>Error codes:</b> 3106</color> \nFor the Data Model, refer to the final step in this diagram (has the same text).
                    end
                end

            else If bulkTransferId does NOT exist
                BULK_PREP_HANDLER -> POS_DAO: Request to persist Transfer Hash \n<color #FF0000><b>Error code:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Persist Bulk Transfer message hash
                hnote over DB #lightyellow
                    bulkTransferDuplicateCheck
                end note
                POS_DAO - -> BULK_PREP_HANDLER: Return success
                deactivate POS_DAO
            end
            deactivate POS_DAO
            
        end

        group Validate Payer
            BULK_PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payer Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            hnote over DB #lightyellow
                participant
                participantCurrency
            end note
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> BULK_PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Validate Payer\n<color #FF0000><b>Error codes:</b> 3202</color>
        end
        group Validate Payee
            BULK_PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payee Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            hnote over DB #lightyellow
                participant
                participantCurrency
            end note
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> BULK_PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Validate Payee\n<color #FF0000><b>Error codes:</b> 3203</color>
        end
        BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Validate crypto-condition\n<color #FF0000><b>Error codes:</b> 3100</color>
        
        alt Validate Bulk Prepare Transfer (success)
            group Persist Bulk Transfer State (with bulktransferState='RECEIVED')
                BULK_PREP_HANDLER -> POS_DAO: Request to persist bulk transfer\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Persist bulkTransfer
                hnote over DB #lightyellow
                    bulkTransfer
                    bulkTransferParticipant
                    bulkTransferStateChange
                    bulkTransferExtension
                end note
                activate DB
                deactivate DB
                POS_DAO - -> BULK_PREP_HANDLER: Return success
                deactivate POS_DAO
            end
        else Validate Bulk Prepare Transfer (failure)
            group Persist Bulk Transfer State (with bulkTransferState='INVALID') (Introducing a new status INVALID to mark these entries)
                BULK_PREP_HANDLER -> POS_DAO: Request to persist bulk transfer\n(when Payee/Payer/crypto-condition validation fails)\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Persist transfer
                hnote over DB #lightyellow
                    bulkTransfer
                    bulkTransferParticipant
                    bulkTransferStateChange
                    bulkTransferExtension
                    bulkTransferError
                end note
                activate DB
                deactivate DB
                POS_DAO - -> BULK_PREP_HANDLER: Return success
                deactivate POS_DAO
            end
        end

    end
    alt Validate Bulk Prepare Transfer (success)
        BULK_PREP_HANDLER -> BULK_PREP_HANDLER: Break down the bulk into indidivual transfers\n<color #FF0000><b>Error codes:</b> 2003</color>
        loop for every individual transfer in the bulk
            note right of BULK_PREP_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: bulk-prepare,
                            action: prepare,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            BULK_PREP_HANDLER -> TOPIC_TRANSFER_PREPARE: Route & Publish Prepare event to the Payer for the Individual Transfer\n<color #FF0000><b>Error codes:</b> 2003</color>
            activate TOPIC_TRANSFER_PREPARE
            deactivate TOPIC_TRANSFER_PREPARE
        end
    else Validate Bulk Prepare Transfer (failure)
        note right of BULK_PREP_HANDLER #yellow
            Message:
            {
                id: <bulkTransferMessage.bulkTransferId>
                from: <ledgerName>,
                to: <bulkTransferMessage.payerFsp>,
                type: application/json
                content: {
                    headers: <bulkTransferHeaders>,
                    payload: {
                        "errorInformation": {
                            "errorCode": <possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]>
                            "errorDescription": "<refer to section 35.1.3 for description>",
                            "extensionList": <transferMessage.extensionList>
                    }
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: bulk-notification,
                        action: bulk-abort,
                        createdAt: <timestamp>,
                        state: {
                            status: 'error',
                            code: <errorInformation.errorCode>
                            description: <errorInformation.errorDescription>
                        }
                    }
                }
            }
        end note
        BULK_PREP_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification (failure) event for Payer\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_BULK_PROCESSING
        deactivate TOPIC_BULK_PROCESSING
    end
end
deactivate BULK_PREP_HANDLER
@enduml

PlantUML version 1.2019.03(Sun Mar 10 16:34:44 IST 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_151-b12
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>