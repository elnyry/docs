<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2495px" preserveAspectRatio="none" style="width:2797px;height:2495px;" version="1.1" viewBox="0 0 2797 2495" width="2797px" zoomAndPan="magnify"><defs><filter height="300%" id="fcprj080swobd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="437" x="1181" y="23.5352">1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><rect fill="#D3D3D3" height="2450.1133" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="2450.1133" style="stroke: #A80036; stroke-width: 1.0;" width="581.5" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="498.75" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="2450.1133" style="stroke: #A80036; stroke-width: 1.0;" width="1910" x="870" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1774.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="594.627" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="1014.2344"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="2207.8496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="742.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="86.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1091" y="1492.6191"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="2207.8496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1449" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="2207.8496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1784" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="2207.8496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2113" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="2207.8496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2457" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="2193.8496" style="stroke: #000000; stroke-width: 2.0;" width="2753" x="33" y="170.7754"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="747" x2="747" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="941" x2="941" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1096" x2="1096" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1454" x2="1454" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1629" x2="1629" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1788.5" x2="1788.5" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1949" x2="1949" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2117.5" x2="2117.5" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2277.5" x2="2277.5" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2461.5" x2="2461.5" y1="153.7754" y2="2381.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2701" x2="2701" y1="153.7754" y2="2381.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="150.8223">Payer</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#fcprj080swobd)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="2394.1602">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="2410.6484">Payer</text><ellipse cx="67.5" cy="2423.6016" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,2431.6016 L67.5,2458.6016 M54.5,2439.6016 L80.5,2439.6016 M67.5,2458.6016 L54.5,2473.6016 M67.5,2458.6016 L80.5,2473.6016 " fill="none" filter="url(#fcprj080swobd)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="150.8223">Payee</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#fcprj080swobd)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="2394.1602">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="2410.6484">Payee</text><ellipse cx="126.5" cy="2423.6016" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,2431.6016 L126.5,2458.6016 M113.5,2439.6016 L139.5,2439.6016 M126.5,2458.6016 L113.5,2473.6016 M126.5,2458.6016 L139.5,2473.6016 " fill="none" filter="url(#fcprj080swobd)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="150.8223">ML API Adapter</text><path d="M325,109.2871 L325,133.2871 M325,121.2871 L342,121.2871 " fill="none" filter="url(#fcprj080swobd)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="121.2871" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="2394.1602">ML API Adapter</text><path d="M325,2401.1133 L325,2425.1133 M325,2413.1133 L342,2413.1133 " fill="none" filter="url(#fcprj080swobd)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="2413.1133" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="631" y="150.8223">ML API Notification Event Handler</text><ellipse cx="747.5" cy="121.2871" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="743.5,109.2871,749.5,104.2871,747.5,109.2871,749.5,114.2871,743.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="631" y="2394.1602">ML API Notification Event Handler</text><ellipse cx="747.5" cy="2413.1133" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="743.5,2401.1133,749.5,2396.1133,747.5,2401.1133,749.5,2406.1133,743.5,2401.1133" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="874" y="150.8223">Central Service API</text><path d="M920.5,109.2871 L920.5,133.2871 M920.5,121.2871 L937.5,121.2871 " fill="none" filter="url(#fcprj080swobd)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="949.5" cy="121.2871" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="874" y="2394.1602">Central Service API</text><path d="M920.5,2401.1133 L920.5,2425.1133 M920.5,2413.1133 L937.5,2413.1133 " fill="none" filter="url(#fcprj080swobd)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="949.5" cy="2413.1133" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1022" y="114.2871"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1018" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="1025" y="138.8223">topic-bulk-prepare</text><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1022" y="2380.625"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1018" y="2384.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="1025" y="2405.1602">topic-bulk-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="1379" y="150.8223">Bulk Prepare Handler</text><ellipse cx="1454" cy="121.2871" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1450,109.2871,1456,104.2871,1454,109.2871,1456,114.2871,1450,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="1379" y="2394.1602">Bulk Prepare Handler</text><ellipse cx="1454" cy="2413.1133" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1450,2401.1133,1456,2396.1133,1454,2401.1133,1456,2406.1133,1450,2401.1133" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="1543" y="114.2871"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="1539" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="1546" y="138.8223">topic-transfer-prepare</text><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="1543" y="2380.625"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="1539" y="2384.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="1546" y="2405.1602">topic-transfer-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1730.5" y="150.8223">Prepare Handler</text><ellipse cx="1789" cy="121.2871" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1785,109.2871,1791,104.2871,1789,109.2871,1791,114.2871,1785,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1730.5" y="2394.1602">Prepare Handler</text><ellipse cx="1789" cy="2413.1133" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1785,2401.1133,1791,2396.1133,1789,2401.1133,1791,2406.1133,1785,2401.1133" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1862" y="114.2871"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1858" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1865" y="138.8223">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1862" y="2380.625"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1858" y="2384.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1865" y="2405.1602">topic-transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2058.5" y="150.8223">Position Handler</text><ellipse cx="2118" cy="121.2871" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2114,109.2871,2120,104.2871,2118,109.2871,2120,114.2871,2114,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2058.5" y="2394.1602">Position Handler</text><ellipse cx="2118" cy="2413.1133" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2114,2401.1133,2120,2396.1133,2118,2401.1133,2120,2406.1133,2114,2401.1133" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="2193.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="2189.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="2196.5" y="138.8223">topic-bulk-processing</text><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="2193.5" y="2380.625"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="2189.5" y="2384.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="2196.5" y="2405.1602">topic-bulk-processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="2376.5" y="150.8223">Bulk Processing Handler</text><ellipse cx="2462" cy="121.2871" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2458,109.2871,2464,104.2871,2462,109.2871,2464,114.2871,2458,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="2376.5" y="2394.1602">Bulk Processing Handler</text><ellipse cx="2462" cy="2413.1133" fill="#FEFECE" filter="url(#fcprj080swobd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2458,2401.1133,2464,2396.1133,2462,2401.1133,2464,2406.1133,2458,2401.1133" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="2630" y="114.2871"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="2626" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="2633" y="138.8223">Notifications-topic</text><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="2630" y="2380.625"/><rect fill="#FEFECE" filter="url(#fcprj080swobd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="2626" y="2384.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="2633" y="2405.1602">Notifications-topic</text><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="594.627" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="1014.2344"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="2207.8496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="742.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="86.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1091" y="1492.6191"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="2207.8496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1449" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="2207.8496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1784" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="2207.8496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2113" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="2207.8496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2457" y="163.7754"/><path d="M33,170.7754 L445,170.7754 L445,177.7754 L435,187.7754 L33,187.7754 L33,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2193.8496" style="stroke: #000000; stroke-width: 2.0;" width="2753" x="33" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="367" x="48" y="184.3438">DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><path d="M72,193.0859 L72,983.0859 L413,983.0859 L413,203.0859 L403,193.0859 L72,193.0859 " fill="#FFFF00" filter="url(#fcprj080swobd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M403,193.0859 L403,203.0859 L413,203.0859 L403,193.0859 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="78" y="210.6543">Headers - bulkTransferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="94" y="225.9648">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="94" y="241.2754">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="94" y="256.5859">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="271.8965">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="94" y="287.207">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="94" y="302.5176">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="94" y="317.8281">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="333.1387">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="94" y="348.4492">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="94" y="363.7598">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="379.0703">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="82" y="394.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="78" y="409.6914">Payload - bulkTransferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="425.002">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="94" y="440.3125">"bulkTransferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="94" y="455.623">"bulkQuoteId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="94" y="470.9336">"payeeFsp": &lt;fspID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="94" y="486.2441">"payerFsp": &lt;fspID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="94" y="501.5547">"individualTransfers":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="516.8652">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="532.1758">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="126" y="547.4863">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="126" y="562.7969">"transferAmount":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="578.1074">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="142" y="593.418">"currency": &lt;currency&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="142" y="608.7285">"amount": &lt;amount&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="126" y="624.0391">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="126" y="639.3496">"ilpPacket": &lt;ilpPacket&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="126" y="654.6602">"condition": &lt;ilpCondition&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="126" y="669.9707">"extensionList":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="685.2813">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="142" y="700.5918">"extension":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="142" y="715.9023">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="158" y="731.2129">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="174" y="746.5234">“key”: &lt;key&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="174" y="761.834">“value”: &lt;value&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="158" y="777.1445">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="142" y="792.4551">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="807.7656">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="823.0762">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="838.3867">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="94" y="853.6973">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="110" y="869.0078">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="884.3184">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="142" y="899.6289">“key”: &lt;key&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="142" y="914.9395">“value”: &lt;value&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="930.25">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="945.5605">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="960.8711">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="976.1816">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="1014.2344" y2="1010.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="1014.2344" y2="1018.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="339.5" y1="1014.2344" y2="1014.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="1009.4922">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="87.5" y="1009.4922">POST - /bulkTransfers</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="392.5" y1="1058.8555" y2="1058.8555"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="392.5" x2="392.5" y1="1058.8555" y2="1071.8555"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351.5" x2="392.5" y1="1071.8555" y2="1071.8555"/><polygon fill="#A80036" points="361.5,1067.8555,351.5,1071.8555,361.5,1075.8555,357.5,1071.8555" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1046.458">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="365" x="370.5" y="1038.8027">Validate incoming message and originator matching Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="370.5" y="1054.1133">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="454.5" y="1054.1133">3000-3002, 3100-3107</text><path d="M355,1084.8555 L355,1446.8555 L648,1446.8555 L648,1094.8555 L638,1084.8555 L355,1084.8555 " fill="#FFFF00" filter="url(#fcprj080swobd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M638,1084.8555 L638,1094.8555 L648,1094.8555 L638,1084.8555 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="1102.4238">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1117.7344">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="377" y="1133.0449">id: &lt;bulkTransferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="377" y="1148.3555">from: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="377" y="1163.666">to: &lt;bulkTransferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="1178.9766">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="377" y="1194.2871">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="393" y="1209.5977">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="393" y="1224.9082">payload: &lt;bulkTransferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="1240.2188">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="1255.5293">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="1270.8398">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="1286.1504">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="409" y="1301.4609">type: bulkPrepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="409" y="1316.7715">action: bulkPrepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="409" y="1332.082">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="409" y="1347.3926">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="425" y="1362.7031">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="1378.0137">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="1393.3242">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1408.6348">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="1423.9453">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1439.2559">}</text><polygon fill="#A80036" points="1079,1488.6191,1089,1492.6191,1079,1496.6191,1083,1492.6191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1085" y1="1492.6191" y2="1492.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1480.2217">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="370.5" y="1472.5664">Route &amp; Publish Bulk Prepare event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="370.5" y="1487.877">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="447.5" y="1487.877">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1101" x2="1143" y1="1537.2402" y2="1537.2402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1143" x2="1143" y1="1537.2402" y2="1550.2402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1102" x2="1143" y1="1550.2402" y2="1550.2402"/><polygon fill="#A80036" points="1112,1546.2402,1102,1550.2402,1112,1554.2402,1108,1550.2402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1108" y="1524.8428">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="321" x="1121" y="1517.1875">Ensure event is replicated as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="1121" y="1532.498">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1198" y="1532.498">2003</text><polygon fill="#A80036" points="361.5,1575.5508,351.5,1579.5508,361.5,1583.5508,357.5,1579.5508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="355.5" x2="1095" y1="1579.5508" y2="1579.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1574.8086">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="373" x="380.5" y="1574.8086">Respond replication acknowledgements have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1608.8613" y2="1604.8613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1608.8613" y2="1612.8613"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="67.5" x2="344.5" y1="1608.8613" y2="1608.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="1604.1191">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="1604.1191">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1107,1659.1719,1097,1663.1719,1107,1667.1719,1103,1663.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1101" x2="1448" y1="1663.1719" y2="1663.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1113" y="1658.4297">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1126" y="1658.4297">Consume message</text><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="703" x="1015" y="1671.1719"/><polygon fill="#EEEEEE" points="1015,1671.1719,1079,1671.1719,1079,1678.1719,1069,1688.1719,1015,1688.1719,1015,1671.1719" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1028" y="1685.7402">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="1270" y="1704.7402">Bulk Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1274" y="1720.0508"/><polygon fill="#A80036" points="1617,1749.4141,1627,1753.4141,1617,1757.4141,1621,1753.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1459" x2="1623" y1="1753.4141" y2="1753.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1466" y="1748.6719">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1479" y="1748.6719">Produce message</text><polygon fill="#A80036" points="1640,1803.7246,1630,1807.7246,1640,1811.7246,1636,1807.7246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1634" x2="1783" y1="1807.7246" y2="1807.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1646" y="1802.9824">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1659" y="1802.9824">Consume message</text><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="503" x="1536" y="1815.7246"/><polygon fill="#EEEEEE" points="1536,1815.7246,1600,1815.7246,1600,1822.7246,1590,1832.7246,1536,1832.7246,1536,1815.7246" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1549" y="1830.293">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="1653" y="1849.293">Prepare Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.1.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.1.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="43" x="1823" y="1849.293">1.1.1.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1823" x2="1866" y1="1851.293" y2="1851.293"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1866" y="1849.293">,</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.1.b.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.1.b.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="44" x="1874" y="1849.293">1.1.1.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1874" x2="1918" y1="1851.293" y2="1851.293"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1918" y="1849.293">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1657" y="1864.6035"/><polygon fill="#A80036" points="1937,1893.9668,1947,1897.9668,1937,1901.9668,1941,1897.9668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1794" x2="1943" y1="1897.9668" y2="1897.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1801" y="1893.2246">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1823" y="1893.2246">Produce message</text><polygon fill="#A80036" points="1960,1948.2773,1950,1952.2773,1960,1956.2773,1956,1952.2773" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1954" x2="2112" y1="1952.2773" y2="1952.2773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1966" y="1947.5352">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1988" y="1947.5352">Consume message</text><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="510.5" x="1855" y="1960.2773"/><polygon fill="#EEEEEE" points="1855,1960.2773,1919,1960.2773,1919,1967.2773,1909,1977.2773,1855,1977.2773,1855,1960.2773" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1868" y="1974.8457">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="1973.25" y="1993.8457">Position Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.2.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.2.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="43" x="2148.25" y="1993.8457">1.1.2.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2148.25" x2="2191.25" y1="1995.8457" y2="1995.8457"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2191.25" y="1993.8457">,</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.2.b.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.2.b.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="44" x="2199.25" y="1993.8457">1.1.2.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2199.25" x2="2243.25" y1="1995.8457" y2="1995.8457"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2243.25" y="1993.8457">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1977.25" y="2009.1563"/><polygon fill="#A80036" points="2266,2038.5195,2276,2042.5195,2266,2046.5195,2270,2042.5195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2123" x2="2272" y1="2042.5195" y2="2042.5195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2130" y="2037.7773">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="2152" y="2037.7773">Produce message</text><polygon fill="#A80036" points="2289,2092.8301,2279,2096.8301,2289,2100.8301,2285,2096.8301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2283" x2="2456" y1="2096.8301" y2="2096.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2295" y="2092.0879">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="2317" y="2092.0879">Consume message</text><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="588.5" x="2186.5" y="2104.8301"/><polygon fill="#EEEEEE" points="2186.5,2104.8301,2250.5,2104.8301,2250.5,2111.8301,2240.5,2121.8301,2186.5,2121.8301,2186.5,2104.8301" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="2199.5" y="2119.3984">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="2373.25" y="2138.3984">Bulk Processing Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2377.25" y="2153.709"/><polygon fill="#A80036" points="2689,2183.0723,2699,2187.0723,2689,2191.0723,2693,2187.0723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="2467" x2="2695" y1="2187.0723" y2="2187.0723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2474" y="2182.3301">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="2496" y="2182.3301">Send Bulk Prepare notification</text><polygon fill="#A80036" points="2689,2237.3828,2699,2241.3828,2689,2245.3828,2693,2241.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="752.5" x2="2695" y1="2241.3828" y2="2241.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="759.5" y="2236.6406">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="781.5" y="2236.6406">Consume message</text><rect fill="#FFFFFF" filter="url(#fcprj080swobd)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="2676" x="99" y="2249.3828"/><polygon fill="#EEEEEE" points="99,2249.3828,163,2249.3828,163,2256.3828,153,2266.3828,99,2266.3828,99,2249.3828" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="112" y="2263.9512">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="1262.5" y="2282.9512">Send notification to Participant (Payee) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="43" x="1512.5" y="2282.9512">1.1.4.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1512.5" x2="1555.5" y1="2284.9512" y2="2284.9512"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1555.5" y="2282.9512">,</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.4.b.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.4.b.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="44" x="1563.5" y="2282.9512">1.1.4.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1563.5" x2="1607.5" y1="2284.9512" y2="2284.9512"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1607.5" y="2282.9512">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1266.5" y="2298.2617"/><polygon fill="#A80036" points="137.5,2327.625,127.5,2331.625,137.5,2335.625,133.5,2331.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="741.5" y1="2331.625" y2="2331.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143.5" y="2326.8828">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="165.5" y="2326.8828">Send Bulk Prepare notification to Payee</text><!--
@startuml
title 1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "topic-bulk-prepare" as TOPIC_BULK_PREPARE
control "Bulk Prepare Handler" as BULK_PREP_HANDLER
collections "topic-transfer-prepare" as TOPIC_TRANSFER_PREPARE
control "Prepare Handler" as PREP_HANDLER
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
control "Position Handler" as POS_HANDLER
collections "topic-bulk-processing" as TOPIC_BULK_PROCESSING
control "Bulk Processing Handler" as BULK_PROC_HANDLER
collections "Notifications-topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_BULK_PREPARE
    participant BULK_PREP_HANDLER
    participant TOPIC_TRANSFER_PREPARE
    participant PREP_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_BULK_PROCESSING
    participant BULK_PROC_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate BULK_PREP_HANDLER
activate PREP_HANDLER
activate POS_HANDLER
activate BULK_PROC_HANDLER
group DFSP1 sends a Bulk Prepare Transfer request to DFSP2
    note right of DFSP1 #yellow
        Headers - bulkTransferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - bulkTransferMessage:
        {
            "bulkTransferId": <uuid>,
            "bulkQuoteId": <uuid>, 
            "payeeFsp": <fspID>,
            "payerFsp": <fspID>,
            "individualTransfers": 
            [
                {
                    "transferId": <uuid>, 
                    "transferAmount": 
                    { 
                        "currency": <currency>, 
                        "amount": <amount> 
                    }, 
                    "ilpPacket": <ilpPacket>,
                    "condition": <ilpCondition>,
                    "extensionList":
                    {
                        "extension":
                        [ 
                            { 
                                “key”: <key>, 
                                “value”: <value> 
                            }
                        ]
                    }
                }
            ],
            "extensionList": {
                "extension": [
                    {
                        “key”: <key>, 
                        “value”: <value> 
                    }
                ]
            }
        }
    end note
    DFSP1 ->> MLAPI: POST - /bulkTransfers
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming message and originator matching Payer\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    note right of MLAPI #yellow
        Message:
        {
            id: <bulkTransferMessage.transferId>
            from: <bulkTransferMessage.payerFsp>,
            to: <bulkTransferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <bulkTransferHeaders>,
                payload: <bulkTransferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: bulkPrepare,
                    action: bulkPrepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_BULK_PREPARE: Route & Publish Bulk Prepare event for Payer\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_BULK_PREPARE
    TOPIC_BULK_PREPARE <-> TOPIC_BULK_PREPARE: Ensure event is replicated as configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_BULK_PREPARE - -> MLAPI: Respond replication acknowledgements have been received
    deactivate TOPIC_BULK_PREPARE
    MLAPI - ->> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    |||
    TOPIC_BULK_PREPARE <- BULK_PREP_HANDLER: Consume message
    ref over TOPIC_BULK_PREPARE, BULK_PREP_HANDLER, TOPIC_TRANSFER_PREPARE :  Bulk Prepare Handler Consume \n
    BULK_PREP_HANDLER -> TOPIC_TRANSFER_PREPARE: Produce message
    |||
    TOPIC_TRANSFER_PREPARE <- PREP_HANDLER: Consume message
    ref over TOPIC_TRANSFER_PREPARE, PREP_HANDLER, TOPIC_TRANSFER_POSITION :  Prepare Handler Consume {[[https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.1.a.svg 1.1.1.a]], [[https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.1.b.svg 1.1.1.b]]} \n
    PREP_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, POS_HANDLER, TOPIC_BULK_PROCESSING : Position Handler Consume {[[https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.2.a.svg 1.1.2.a]], [[https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.2.b.svg 1.1.2.b]]} \n
    POS_HANDLER -> TOPIC_BULK_PROCESSING: Produce message
    |||
    TOPIC_BULK_PROCESSING <- BULK_PROC_HANDLER: Consume message
    ref over TOPIC_BULK_PROCESSING, BULK_PROC_HANDLER, TOPIC_NOTIFICATIONS : Bulk Processing Handler Consume \n
    BULK_PROC_HANDLER - -> TOPIC_NOTIFICATIONS: Send Bulk Prepare notification
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    ref over DFSP2, TOPIC_NOTIFICATIONS : Send notification to Participant (Payee) {[[https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg 1.1.4.a]], [[https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-prepare-1.1.4.b.svg 1.1.4.b]]} \n
    NOTIFY_HANDLER -> DFSP2: Send Bulk Prepare notification to Payee
    |||
end
deactivate POS_HANDLER
deactivate BULK_PREP_HANDLER
deactivate PREP_HANDLER
deactivate BULK_PROC_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2019.03(Sun Mar 10 16:34:44 IST 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_151-b12
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>